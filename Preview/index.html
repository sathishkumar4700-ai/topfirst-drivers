<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top First Call Drivers - Chennai</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .homepage {
            min-height: 100vh;
        }

        .navbar {
            background: #1a1a2e;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            color: #ffd700;
            font-weight: 800;
            letter-spacing: 1px;
            text-transform: uppercase;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
            font-family: 'Arial Black', sans-serif;
        }

        .logo-icon {
            display: inline-block;
            margin-right: 0.5rem;
            font-size: 1.8rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .btn-contact {
            background: #ffd700;
            border: 2px solid #ffd700;
            color: #1a1a2e;
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-contact:hover {
            background: #ffed4e;
            border-color: #ffed4e;
            transform: translateY(-2px);
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero .tagline {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        .btn-primary {
            background: #25D366;
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .btn-primary:hover {
            background: #20BA5A;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .intro {
            padding: 60px 0;
            background: white;
        }

        .intro-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }

        .intro-text-section h3 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #1a1a2e;
        }

        .intro-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #333;
            text-align: justify;
            margin-bottom: 1.5rem;
        }

        .intro-image-section {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .driver-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            display: block;
        }

        .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 2rem;
            color: white;
        }

        .image-overlay p {
            margin: 0;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }

        .features {
            padding: 60px 0;
            background: #f9f9f9;
        }

        .features h3 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 3rem;
            color: #1a1a2e;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
        }

        .services {
            padding: 60px 0;
            background: white;
        }

        .services h3 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 3rem;
            color: #1a1a2e;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .service-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .service-card h4 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .contact {
            padding: 60px 0;
            background: #f9f9f9;
        }

        .contact h3 {
            font-size: 2rem;
            margin-bottom: 3rem;
            color: #1a1a2e;
            text-align: center;
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .contact-item {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.3s ease;
        }

        .contact-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .contact-icon {
            font-size: 2.5rem;
        }

        .contact-item strong {
            display: block;
            color: #667eea;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .contact-item p {
            margin: 0;
            color: #333;
        }

        .contact-item a {
            color: #1a1a2e;
            text-decoration: none;
            font-weight: 500;
        }

        .contact-item a:hover {
            color: #667eea;
        }

        .whatsapp-cta {
            text-align: center;
            margin-top: 2rem;
        }

        .btn-whatsapp {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: #25D366;
            color: white;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            text-decoration: none;
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
            transition: all 0.3s ease;
        }

        .btn-whatsapp:hover {
            background: #20BA5A;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-icon {
            font-size: 1.8rem;
        }

        footer {
            background: #1a1a2e;
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .navbar .container {
                flex-direction: column;
                gap: 1rem;
            }

            .logo {
                font-size: 1rem;
            }

            .logo-icon {
                font-size: 1.3rem;
            }

            .btn-contact {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }

            .hero {
                padding: 60px 0;
            }

            .hero h2 {
                font-size: 1.8rem;
            }

            .hero .tagline {
                font-size: 1rem;
            }

            .intro-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .intro-text-section h3 {
                font-size: 1.5rem;
                text-align: center;
            }

            .driver-image {
                height: 300px;
            }

            .features-grid,
            .service-grid {
                grid-template-columns: 1fr;
            }

            .contact-info {
                grid-template-columns: 1fr;
            }

            .contact-item {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 0.85rem;
            }

            .logo-icon {
                font-size: 1.1rem;
            }

            .hero h2 {
                font-size: 1.5rem;
            }

            .btn-primary,
            .btn-whatsapp {
                width: 100%;
                justify-content: center;
            }

            .driver-image {
                height: 250px;
            }
        }

        /* Notification System Styles */
        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0.5rem;
            transition: transform 0.3s;
        }

        .notification-bell:hover {
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse-badge 2s infinite;
        }

        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .notification-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            overflow: hidden;
        }

        .notification-panel.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: #e7f3ff;
        }

        .notification-item .notification-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .notification-item .notification-message {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .notification-item .notification-time {
            font-size: 0.75rem;
            color: #999;
        }

        .notification-empty {
            padding: 2rem;
            text-align: center;
            color: #999;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 1rem 1.5rem;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left: 4px solid #10ac84;
        }

        .toast.error {
            border-left: 4px solid #ff6b6b;
        }

        .toast.warning {
            border-left: 4px solid #ffd700;
        }

        .toast.info {
            border-left: 4px solid #667eea;
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #333;
        }

        .toast-message {
            font-size: 0.9rem;
            color: #666;
        }

        .toast-close {
            cursor: pointer;
            font-size: 1.2rem;
            color: #999;
            transition: color 0.2s;
        }

        .toast-close:hover {
            color: #333;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .notification-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }

            .toast-container {
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: auto;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="homepage">
        <nav class="navbar">
            <div class="container">
                <h1 class="logo">
                    <span class="logo-icon">üöó</span>
                    <span style="color: #ffd700;">Top</span>
                    <span style="color: #ffed4e;">First</span>
                    <span style="color: #ffd700;">Call Drivers</span>
                </h1>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <div class="notification-bell" onclick="toggleNotificationPanel()" title="Notifications">
                        üîî
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </div>
                    <a href="#" onclick="openCreateAccount(); return false;" class="btn-contact" style="background: linear-gradient(135deg, #667eea, #764ba2); border-color: #667eea; font-weight: 700;">
                        ‚ú® Create Account
                    </a>
                    <a href="#" onclick="openLogin(); return false;" class="btn-contact" style="background: #10ac84; border-color: #10ac84; font-weight: 600;">
                        üîê Login
                    </a>
                    <a href="#contact" class="btn-contact">
                        üìû Contact
                    </a>
                </div>
            </div>
        </nav>

        <section class="hero">
            <div class="container">
                <h2 style="font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                    <span style="font-size: 3rem;">üöó</span><br>
                    <span style="color: #ffd700;">Top First</span> 
                    <span style="color: white;">Call Drivers</span><br>
                    <span style="font-size: 1.5rem; font-weight: 600;">in Chennai</span>
                </h2>
                <p class="tagline" style="font-weight: 500; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">Your Trusted Solution for Professional, Reliable, and Trained Drivers</p>
                <a href="https://wa.me/919962366104?text=Hi%2C%20I%20need%20a%20driver" target="_blank" class="btn-primary">
                    üí¨ Book via WhatsApp
                </a>
            </div>
        </section>

        <section class="intro">
            <div class="container">
                <div class="intro-content">
                    <div class="intro-text-section">
                        <h3 style="font-weight: 700;">
                            Welcome to 
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                Top First Call Drivers
                            </span>
                        </h3>
                        <p class="intro-text">
                            Top First Call Drivers in Chennai is your trusted solution for hiring professional, reliable, and trained drivers anytime you need them. 
                            Whether it's a late-night pickup, an outstation trip, a personal chauffeur for your car, or a temporary driver for daily commuting, 
                            we ensure a smooth and safe driving experience across the city.
                        </p>
                        <p class="intro-text">
                            With a team of verified, experienced, and courteous drivers, we focus on delivering convenience, comfort, and complete peace of mind. 
                            Our services are designed to suit individuals, families, corporates, and businesses who require dependable drivers on demand.
                        </p>
                    </div>
                    <div class="intro-image-section">
                        <img 
                            src="https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?w=600&h=400&fit=crop" 
                            alt="Professional Driver" 
                            class="driver-image"
                        />
                        <div class="image-overlay">
                            <p>Professional & Verified Drivers</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <h3>Why Choose Us?</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üïê</div>
                        <h4>24/7 Availability</h4>
                        <p>Book a driver anytime‚Äîday or night‚Äîwithin minutes</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚úì</div>
                        <h4>Verified & Experienced</h4>
                        <p>Background-checked professionals with valid licenses and city driving expertise</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üí∞</div>
                        <h4>Transparent Pricing</h4>
                        <p>No hidden costs; clear hourly, daily, and outstation rates</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üè†</div>
                        <h4>Home Pickup & Drop</h4>
                        <p>Drivers reach your doorstep or pickup point on time</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üöó</div>
                        <h4>City & Outstation</h4>
                        <p>Perfect for daily errands, meetings, events, and long-distance travel</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üõ°Ô∏è</div>
                        <h4>Safe & Responsible</h4>
                        <p>Alcohol-free, disciplined, and trained in defensive driving</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚è±Ô∏è</div>
                        <h4>Flexible Booking</h4>
                        <p>Hourly, shift-based, full-day, and outstation driver services</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üè¢</div>
                        <h4>Corporate & Events</h4>
                        <p>Bulk hiring options for companies, hotels, and special events</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìû</div>
                        <h4>Customer Support</h4>
                        <p>Quick response and real-time updates through call or WhatsApp</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="services">
            <div class="container">
                <h3>Our Services</h3>
                <div class="service-grid">
                    <div class="service-card">
                        <h4>Hourly Drivers</h4>
                        <p>Hire drivers by the hour for your convenience. Perfect for shopping, errands, or short trips around the city.</p>
                    </div>
                    <div class="service-card">
                        <h4>Airport Transfers</h4>
                        <p>Reliable pickup and drop services for hassle-free airport commutes at any time.</p>
                    </div>
                    <div class="service-card">
                        <h4>Outstation Trips</h4>
                        <p>Long distance travel with experienced drivers who know the routes well.</p>
                    </div>
                    <div class="service-card">
                        <h4>Corporate Services</h4>
                        <p>Professional drivers for business needs, meetings, and corporate events.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact" id="contact">
            <div class="container">
                <h3>Contact Us</h3>
                <div class="contact-info">
                    <div class="contact-item">
                        <span class="contact-icon">üìû</span>
                        <div>
                            <strong>Primary Contact</strong>
                            <p><a href="tel:+919962366104">+91 9962366104</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">‚úâÔ∏è</span>
                        <div>
                            <strong>Email</strong>
                            <p><a href="mailto:kraja4700@gmail.com">kraja4700@gmail.com</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">üí¨</span>
                        <div>
                            <strong>WhatsApp</strong>
                            <p><a href="https://wa.me/919962366104" target="_blank">+91 9962366104</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">üìç</span>
                        <div>
                            <strong>Location</strong>
                            <p>Chennai, Tamil Nadu</p>
                        </div>
                    </div>
                </div>
                <div class="whatsapp-cta">
                    <a href="https://wa.me/919962366104?text=Hi%2C%20I%20need%20a%20driver%20for%20" 
                       target="_blank" 
                       rel="noopener noreferrer" 
                       class="btn-whatsapp">
                        <span class="whatsapp-icon">üí¨</span> Chat on WhatsApp
                    </a>
                </div>
            </div>
        </section>

        <footer>
            <div class="container" style="text-align: center;">
                <p style="font-weight: 600;">
                    &copy; 2024 
                    <span style="color: #ffd700; font-weight: 700;">Top First Call Drivers</span>
                    . All rights reserved.
                </p>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #999;">
                    üöó Professional Driver Services in Chennai | Available 24/7
                </p>
            </div>
        </footer>

        <!-- Admin/Driver Portal Modal -->
        <div id="portalModal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center;">
            <div style="background: white; padding: 2.5rem; border-radius: 15px; width: 90%; max-width: 500px; position: relative; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
                <span onclick="closePortal()" style="position: absolute; right: 1.5rem; top: 1.5rem; font-size: 2rem; font-weight: bold; color: #999; cursor: pointer;">&times;</span>
                <h2 id="portalTitle" style="color: #1a1a2e; margin-bottom: 1.5rem; text-align: center;">Portal Access</h2>
                <div id="portalContent"></div>
            </div>
        </div>

        <script>
            function openAdminPortal() {
                document.getElementById('portalTitle').textContent = 'Admin Portal - Login';
                document.getElementById('portalContent').innerHTML = `
                    <div id="adminForm">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Mobile Number</label>
                            <input type="tel" id="adminMobile" placeholder="Enter 10-digit mobile number" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;"
                                   maxlength="10" pattern="[0-9]{10}">
                        </div>
                        <div id="adminPasswordSection" style="display: none; margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Password</label>
                            <input type="password" id="adminPassword" placeholder="Enter password" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <button onclick="handleAdminAuth()" id="adminAuthBtn" 
                                style="width: 100%; background: #667eea; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                            Continue
                        </button>
                        <p style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #666;">
                            New admin? Request access and wait for approval
                        </p>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            function openDriverPortal() {
                document.getElementById('portalTitle').textContent = 'Driver Login';
                document.getElementById('portalContent').innerHTML = `
                    <div id="driverForm">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Mobile Number</label>
                            <input type="tel" id="driverMobile" placeholder="Enter 10-digit mobile number" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;"
                                   maxlength="10" pattern="[0-9]{10}">
                        </div>
                        <div id="driverPasswordSection" style="display: none; margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Password</label>
                            <input type="password" id="driverPassword" placeholder="Enter password" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <button onclick="handleDriverAuth()" id="driverAuthBtn" 
                                style="width: 100%; background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                            Continue
                        </button>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <p style="margin-bottom: 0.5rem; color: #666;">Don't have an account?</p>
                            <button onclick="showDriverRegistration()" style="width: 100%; background: linear-gradient(135deg, #ffd700, #ffed4e); color: #1a1a2e; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                                ‚≠ê Register as Driver
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            function showDriverRegistration() {
                document.getElementById('portalTitle').textContent = 'üöó Driver Registration';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <form id="driverRegistrationForm" onsubmit="handleDriverRegistration(event)">
                            <!-- Personal Information -->
                            <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
                                <h3 style="color: #10ac84; margin-bottom: 1rem; font-size: 1rem;">Personal Information</h3>
                                <input type="text" id="regName" placeholder="Full Name *" required
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="tel" id="regPhone" placeholder="Phone Number *" required maxlength="10"
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="email" id="regEmail" placeholder="Email *" required
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <textarea id="regAddress" placeholder="Address *" required rows="2"
                                          style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem; font-family: inherit; resize: vertical;"></textarea>
                            </div>

                            <!-- Driver Details -->
                            <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
                                <h3 style="color: #10ac84; margin-bottom: 1rem; font-size: 1rem;">Driver Details</h3>
                                <input type="text" id="regLicense" placeholder="Driving License Number *" required
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="text" id="regAadhar" placeholder="Aadhar Number *" required maxlength="12"
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <select id="regVehicle" required
                                        style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem; background: white;">
                                    <option value="">Select Vehicle Type *</option>
                                    <option value="manual">Manual</option>
                                    <option value="automatic">Automatic</option>
                                    <option value="both">Both</option>
                                </select>
                                <input type="number" id="regExperience" placeholder="Years of Experience *" required min="0"
                                       style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                            </div>

                            <!-- Upload Documents -->
                            <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
                                <h3 style="color: #10ac84; margin-bottom: 1rem; font-size: 1rem;">Upload Documents</h3>
                                <div style="margin-bottom: 0.75rem;">
                                    <label style="display: block; padding: 1rem; border: 2px dashed #ddd; border-radius: 8px; cursor: pointer; text-align: center; background: #f8f9fa; transition: all 0.3s;"
                                           onmouseover="this.style.borderColor='#10ac84'; this.style.background='#f0fff4';"
                                           onmouseout="this.style.borderColor='#ddd'; this.style.background='#f8f9fa';">
                                        üìÑ License Document (Image/PDF)
                                        <input type="file" id="regLicenseDoc" accept="image/*,.pdf" style="display: none;" onchange="updateFileName(this, 'licenseFileName')">
                                        <div id="licenseFileName" style="margin-top: 0.5rem; color: #10ac84; font-size: 0.9rem;"></div>
                                    </label>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <label style="display: block; padding: 1rem; border: 2px dashed #ddd; border-radius: 8px; cursor: pointer; text-align: center; background: #f8f9fa; transition: all 0.3s;"
                                           onmouseover="this.style.borderColor='#10ac84'; this.style.background='#f0fff4';"
                                           onmouseout="this.style.borderColor='#ddd'; this.style.background='#f8f9fa';">
                                        üìÑ Aadhar Document (Image/PDF)
                                        <input type="file" id="regAadharDoc" accept="image/*,.pdf" style="display: none;" onchange="updateFileName(this, 'aadharFileName')">
                                        <div id="aadharFileName" style="margin-top: 0.5rem; color: #10ac84; font-size: 0.9rem;"></div>
                                    </label>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <label style="display: block; padding: 1rem; border: 2px dashed #ddd; border-radius: 8px; cursor: pointer; text-align: center; background: #f8f9fa; transition: all 0.3s;"
                                           onmouseover="this.style.borderColor='#10ac84'; this.style.background='#f0fff4';"
                                           onmouseout="this.style.borderColor='#ddd'; this.style.background='#f8f9fa';">
                                        üì∑ Your Photo (Image)
                                        <input type="file" id="regPhoto" accept="image/*" style="display: none;" onchange="updateFileName(this, 'photoFileName')">
                                        <div id="photoFileName" style="margin-top: 0.5rem; color: #10ac84; font-size: 0.9rem;"></div>
                                    </label>
                                </div>
                            </div>

                            <!-- Account Security -->
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #10ac84; margin-bottom: 1rem; font-size: 1rem;">Account Security</h3>
                                <input type="password" id="regPassword" placeholder="Password *" required minlength="6"
                                       style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                            </div>

                            <button type="submit" style="width: 100%; background: linear-gradient(135deg, #10ac84, #0e9670); color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; margin-bottom: 0.75rem;">
                                ‚úì Submit Registration
                            </button>
                            <button type="button" onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ‚úï Cancel
                            </button>
                        </form>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            function updateFileName(input, displayId) {
                const display = document.getElementById(displayId);
                if (input.files && input.files[0]) {
                    display.textContent = '‚úì ' + input.files[0].name;
                    display.style.fontWeight = '600';
                } else {
                    display.textContent = '';
                }
            }

            function handleDriverRegistration(event) {
                event.preventDefault();
                
                const formData = {
                    name: document.getElementById('regName').value,
                    phone: document.getElementById('regPhone').value,
                    email: document.getElementById('regEmail').value,
                    address: document.getElementById('regAddress').value,
                    licenseNumber: document.getElementById('regLicense').value,
                    aadharNumber: document.getElementById('regAadhar').value,
                    vehicleType: document.getElementById('regVehicle').value,
                    experience: document.getElementById('regExperience').value,
                    password: document.getElementById('regPassword').value
                };

                // Check for duplicate driver registration (same phone cannot register as driver twice)
                if (driverApprovalStatus[formData.phone]) {
                    alert('‚ùå This phone number is already registered as a driver.\n\nPlease login to your driver account instead.');
                    return;
                }

                // Get uploaded files
                const licenseDoc = document.getElementById('regLicenseDoc').files[0];
                const aadharDoc = document.getElementById('regAadharDoc').files[0];
                const photo = document.getElementById('regPhoto').files[0];

                // Store driver as pending approval
                driverApprovalStatus[formData.phone] = {
                    ...formData,
                    isApproved: false,
                    approvalStatus: 'pending',
                    registeredAt: new Date().toISOString(),
                    documents: {
                        license: licenseDoc ? licenseDoc.name : null,
                        aadhar: aadharDoc ? aadharDoc.name : null,
                        photo: photo ? photo.name : null
                    }
                };

                // Save to localStorage
                saveDriverData();

                // Log registration data (in production, this would be sent to backend)
                console.log('Driver Registration Data:', formData);
                console.log('Documents:', { licenseDoc, aadharDoc, photo });
                console.log('Driver stored as pending approval:', driverApprovalStatus[formData.phone]);
                console.log('Total drivers in system:', Object.keys(driverApprovalStatus).length);

                // Driver registration stored - admin can approve from dashboard

                // Send notification to admin (simulated - will show to anyone viewing the page)
                notify(
                    'New Driver Registration üöó',
                    `${formData.name} has registered as a driver`,
                    'driver'
                );

                // Show success message
                document.getElementById('portalTitle').textContent = '‚úì Registration Successful!';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem 0;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; animation: scaleIn 0.5s ease-out;">‚úì</div>
                        <h3 style="color: #10ac84; margin-bottom: 1rem;">Registration Submitted!</h3>
                        <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                            Your driver account has been created successfully.
                        </p>
                        <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #856404; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìã Submitted Details:
                            </p>
                            <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                Name: ${formData.name}
                            </p>
                            <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                Phone: ${formData.phone}
                            </p>
                            <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                Email: ${formData.email}
                            </p>
                            <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                License: ${formData.licenseNumber}
                            </p>
                            <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                Vehicle: ${formData.vehicleType}
                            </p>
                            ${licenseDoc ? '<p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">‚úì License Document Uploaded</p>' : ''}
                            ${aadharDoc ? '<p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">‚úì Aadhar Document Uploaded</p>' : ''}
                            ${photo ? '<p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">‚úì Photo Uploaded</p>' : ''}
                        </div>
                        <div style="background: #e7f3ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #2196F3; margin-bottom: 1.5rem;">
                            <p style="color: #0d47a1; margin: 0; font-size: 0.95rem;">
                                ‚è≥ Your application is pending admin approval. You will be notified once approved.
                            </p>
                        </div>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                            <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">
                                Admins will be notified via:
                            </p>
                            <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                ‚úâÔ∏è Email: kraja4700@gmail.com, sathishkumar4700@gmail.com
                            </p>
                            <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                üí¨ WhatsApp: +91 9962366104, +91 8179824281
                            </p>
                        </div>
                        <button onclick="closePortal()" style="width: 100%; background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚úì Done
                        </button>
                    </div>
                    <style>
                        @keyframes scaleIn {
                            from { transform: scale(0); }
                            to { transform: scale(1); }
                        }
                    </style>
                `;

                // Log registration data (in production, this would be sent to backend)
                console.log('Driver Registration Data:', formData);
                console.log('Documents:', { licenseDoc, aadharDoc, photo });
                
                // TODO: Send to backend API
                // In production, you would send this data to your backend:
                // const formDataToSend = new FormData();
                // Object.keys(formData).forEach(key => formDataToSend.append(key, formData[key]));
                // if (licenseDoc) formDataToSend.append('licenseDoc', licenseDoc);
                // if (aadharDoc) formDataToSend.append('aadharDoc', aadharDoc);
                // if (photo) formDataToSend.append('photo', photo);
                // fetch('/api/auth/register-driver', { method: 'POST', body: formDataToSend });
            }

            function openCustomerPortal() {
                document.getElementById('portalTitle').textContent = 'Customer Portal - Login/Register';
                document.getElementById('portalContent').innerHTML = `
                    <div id="customerForm">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Mobile Number</label>
                            <input type="tel" id="customerMobile" placeholder="Enter 10-digit mobile number" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;"
                                   maxlength="10" pattern="[0-9]{10}">
                        </div>
                        <div id="customerOtpSection" style="display: none; margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Enter OTP</label>
                            <input type="text" id="customerOtp" placeholder="Enter 6-digit OTP" 
                                   style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;"
                                   maxlength="6" pattern="[0-9]{6}">
                            <p id="customerOtpDisplay" style="margin-top: 0.5rem; padding: 0.5rem; background: #e7f3ff; border-radius: 5px; font-weight: 600; color: #0d47a1;"></p>
                        </div>
                        <button onclick="handleCustomerAuth()" id="customerAuthBtn" 
                                style="width: 100%; background: #764ba2; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                            Send OTP
                        </button>
                        <p style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #666;">
                            New customer? OTP will create your account automatically
                        </p>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            // Store generated OTPs
            let generatedOTPs = {};

            // Admin Approval System - SUPER ADMINS (Predefined)
            const superAdmins = {
                '9962366104': {
                    name: 'Kraja',
                    email: 'kraja4700@gmail.com',
                    password: 'Tharish@4700',
                    role: 'super_admin'
                },
                '8179824281': {
                    name: 'Sathish',
                    email: 'sathishkumar4700@gmail.com',
                    password: 'Tharish@4700',
                    role: 'super_admin'
                }
            };
            
            // List of approved admin phone numbers (starts with super admins)
            const approvedAdmins = ['9962366104', '8179824281'];
            let pendingAdminRequests = {};

            function generateOTP() {
                return Math.floor(100000 + Math.random() * 900000).toString();
            }

            function handleAdminAuth() {
                const mobile = document.getElementById('adminMobile').value;
                const passwordSection = document.getElementById('adminPasswordSection');
                const otpSection = document.getElementById('adminOtpSection');
                const authBtn = document.getElementById('adminAuthBtn');
                
                if (!mobile || mobile.length !== 10) {
                    alert('Please enter a valid 10-digit mobile number');
                    return;
                }

                // Step 1: Show password field
                if (passwordSection.style.display === 'none') {
                    passwordSection.style.display = 'block';
                    authBtn.textContent = 'Login';
                    return;
                }

                // Step 2: Verify password and login
                const enteredPassword = document.getElementById('adminPassword').value;
                
                if (!enteredPassword) {
                    alert('Please enter password');
                    return;
                }
                
                // Check if super admin
                if (superAdmins[mobile]) {
                    if (enteredPassword !== superAdmins[mobile].password) {
                        alert('‚ùå Invalid password for super admin');
                        return;
                    }
                    // Password verified, login directly
                    showAdminDashboard(mobile);
                } else {
                    // Not a super admin, request approval
                    requestAdminApproval(mobile);
                }
            }

            function requestAdminApproval(mobile) {
                // Check for duplicate admin request (same phone cannot request admin twice)
                if (superAdmins[mobile] || approvedAdmins.includes(mobile)) {
                    alert('‚ùå This phone number is already registered as an admin.\n\nPlease login to your admin account instead.');
                    closePortal();
                    return;
                }
                
                if (pendingAdminRequests[mobile] && pendingAdminRequests[mobile].status === 'pending') {
                    alert('‚è≥ You already have a pending admin request for this phone number.\n\nPlease wait for approval.');
                    closePortal();
                    return;
                }
                
                // Store pending request
                pendingAdminRequests[mobile] = {
                    requestedAt: new Date().toISOString(),
                    status: 'pending'
                };

                // Admin request stored - super admin can approve

                // Show approval pending message
                document.getElementById('portalTitle').textContent = '‚è≥ Admin Approval Pending';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem 0;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚è≥</div>
                        <h3 style="color: #667eea; margin-bottom: 1rem;">Approval Request Sent!</h3>
                        <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                            Your admin access request has been sent for approval.
                        </p>
                        <div style="background: #e7f3ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #2196F3; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #0d47a1; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üì± Mobile Number: ${mobile}
                            </p>
                            <p style="color: #0d47a1; margin: 0; font-size: 0.9rem;">
                                Notifications sent to:
                            </p>
                            <p style="color: #0d47a1; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                                ‚úâÔ∏è Email: kraja4700@gmail.com, sathishkumar4700@gmail.com<br>
                                üí¨ WhatsApp: +91 9962366104, +91 8179824281
                            </p>
                        </div>
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                            <p style="color: #856404; margin: 0; font-size: 0.9rem;">
                                ‚ö†Ô∏è You will be notified once your request is approved by the super admin.
                            </p>
                        </div>
                        <a href="mailto:kraja4700@gmail.com?subject=Admin%20Access%20Request%20-%20${mobile}&body=Hi%2C%0A%0AI%20am%20requesting%20admin%20access%20for%20Top%20First%20Call%20Drivers.%0A%0AMobile%20Number%3A%20${mobile}%0A%0APlease%20approve%20my%20request.%0A%0AThank%20you!" 
                           style="display: block; background: #667eea; color: white; padding: 0.75rem; border-radius: 8px; text-decoration: none; font-weight: 600; margin-bottom: 0.5rem;">
                            üìß Send Email Request
                        </a>
                        <a href="https://wa.me/919962366104?text=Hi%2C%20I%20am%20requesting%20admin%20access%20for%20Top%20First%20Call%20Drivers.%20My%20mobile%20number%20is%20${mobile}.%20Please%20approve%20my%20request." 
                           target="_blank"
                           style="display: block; background: #25D366; color: white; padding: 0.75rem; border-radius: 8px; text-decoration: none; font-weight: 600; margin-bottom: 0.5rem;">
                            üí¨ Send WhatsApp Request
                        </a>
                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Close
                        </button>
                    </div>
                `;

                console.log('Admin approval request sent for:', mobile);
                console.log('Email notifications: kraja4700@gmail.com, sathishkumar4700@gmail.com');
                console.log('WhatsApp notifications: 9962366104, 8179824281');
            }

            // Super admin functions
            function approveAdmin(mobile) {
                if (!approvedAdmins.includes(mobile)) {
                    approvedAdmins.push(mobile);
                    if (pendingAdminRequests[mobile]) {
                        pendingAdminRequests[mobile].status = 'approved';
                        pendingAdminRequests[mobile].approvedAt = new Date().toISOString();
                    }
                    console.log('‚úÖ Admin approved:', mobile);
                    alert('‚úÖ Admin ' + mobile + ' has been approved!');
                    return true;
                }
                alert('Admin already approved');
                return false;
            }

            function rejectAdmin(mobile) {
                if (pendingAdminRequests[mobile]) {
                    pendingAdminRequests[mobile].status = 'rejected';
                    pendingAdminRequests[mobile].rejectedAt = new Date().toISOString();
                    console.log('‚ùå Admin rejected:', mobile);
                    alert('‚ùå Admin request for ' + mobile + ' has been rejected.');
                    return true;
                }
                return false;
            }

            function viewPendingAdminRequests() {
                console.log('Pending Admin Requests:', pendingAdminRequests);
                const pending = Object.entries(pendingAdminRequests)
                    .filter(([_, req]) => req.status === 'pending')
                    .map(([mobile, req]) => ({ mobile, ...req }));
                
                if (pending.length === 0) {
                    alert('No pending admin requests');
                } else {
                    console.table(pending);
                    alert('Check console for pending requests. Use approveAdmin(mobile) or rejectAdmin(mobile) to manage.');
                }
            }

            function showAdminDashboard(mobile) {
                // Get admin info
                const adminInfo = superAdmins[mobile] || { name: 'Admin', role: 'admin' };
                const isSuperAdmin = superAdmins[mobile] !== undefined;
                
                // Count pending admin requests
                const pendingAdminCount = Object.values(pendingAdminRequests).filter(req => req.status === 'pending').length;
                
                // Calculate real-time statistics
                const totalDrivers = Object.keys(driverApprovalStatus).length;
                const approvedDriversCount = Object.values(driverApprovalStatus).filter(d => d.approvalStatus === 'approved').length;
                const pendingDriversCount = Object.values(driverApprovalStatus).filter(d => d.approvalStatus === 'pending').length;
                const rejectedDriversCount = Object.values(driverApprovalStatus).filter(d => d.approvalStatus === 'rejected').length;
                
                // For now, bookings and customers are 0 (will be populated when backend is connected)
                const totalBookings = 0;
                const activeCustomers = 0;
                const pendingRides = 0;
                
                document.getElementById('portalTitle').textContent = 'üë®‚Äçüíº Admin Dashboard';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0 0 0.5rem 0;">Welcome, ${adminInfo.name}!</h3>
                            <p style="margin: 0; opacity: 0.9;">Mobile: ${mobile}</p>
                            ${isSuperAdmin ? '<p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">üîê Super Admin</p>' : ''}
                        </div>

                        <!-- Dashboard Stats -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center; cursor: pointer;" onclick="showDrivers()">
                                <div style="font-size: 2rem; font-weight: bold; color: #667eea;">${totalDrivers}</div>
                                <div style="font-size: 0.85rem; color: #666;">Total Drivers</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">
                                    ‚úÖ ${approvedDriversCount} | ‚è≥ ${pendingDriversCount} | ‚ùå ${rejectedDriversCount}
                                </div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #10ac84;">${totalBookings}</div>
                                <div style="font-size: 0.85rem; color: #666;">Total Bookings</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">Backend integration pending</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ffd700;">${activeCustomers}</div>
                                <div style="font-size: 0.85rem; color: #666;">Active Customers</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">Backend integration pending</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ff6b6b;">${pendingRides}</div>
                                <div style="font-size: 0.85rem; color: #666;">Pending Rides</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">Backend integration pending</div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;">
                            <button onclick="showBookings()" style="background: #667eea; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üìã All Bookings
                            </button>
                            <button onclick="showDrivers()" style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üöó Manage Drivers
                            </button>
                            <button onclick="showCustomers()" style="background: #764ba2; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üë• Manage Customers
                            </button>
                            <button onclick="showDriverStatus()" style="background: #ffd700; color: #1a1a2e; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ÔøΩ Drivger Status
                            </button>
                            ${isSuperAdmin && pendingAdminCount > 0 ? `
                                <button onclick="showPendingAdminRequests()" style="background: #ff6b6b; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; position: relative;">
                                    üë®‚Äçüíº Admin Requests
                                    <span style="position: absolute; top: -5px; right: -5px; background: #ffd700; color: #1a1a2e; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">${pendingAdminCount}</span>
                                </button>
                            ` : isSuperAdmin ? `
                                <button onclick="showPendingAdminRequests()" style="background: #ff6b6b; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    üë®‚ÄçÔøΩ Admnin Requests
                                </button>
                            ` : ''}
                            <button onclick="showReports()" style="background: #4ecdc4; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üìä View Reports
                            </button>
                            <button onclick="assignRide()" style="background: #9b59b6; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üéØ Assign Rides
                            </button>
                            <button onclick="exportAllData()" style="background: #e74c3c; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üì§ Export Data
                            </button>
                            <button onclick="importAllData()" style="background: #27ae60; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üì• Import Data
                            </button>
                        </div>

                        <!-- Recent Activity -->
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 1rem 0; color: #333;">Recent Activity</h4>
                            ${pendingDriversCount > 0 || pendingAdminCount > 0 ? `
                                <div style="font-size: 0.9rem; color: #666; line-height: 1.8;">
                                    ${pendingDriversCount > 0 ? `<div>‚è≥ ${pendingDriversCount} driver application(s) pending approval</div>` : ''}
                                    ${pendingAdminCount > 0 ? `<div>‚è≥ ${pendingAdminCount} admin request(s) pending approval</div>` : ''}
                                    ${approvedDriversCount > 0 ? `<div>‚úÖ ${approvedDriversCount} driver(s) approved and active</div>` : ''}
                                    ${totalDrivers === 0 ? `<div style="color: #999;">No activity yet. Waiting for driver registrations...</div>` : ''}
                                </div>
                            ` : `
                                <div style="font-size: 0.9rem; color: #999; text-align: center; padding: 1rem;">
                                    No recent activity. System is ready for operations.
                                </div>
                            `}
                        </div>

                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Logout
                        </button>
                    </div>
                `;
            }

            // Driver Approval System
            let registeredDrivers = {};
            let pendingDrivers = {};
            let approvedDrivers = [];
            
            // Store driver approval status (in production, this would be in database)
            // Load from localStorage if available
            let driverApprovalStatus = {};
            try {
                const stored = localStorage.getItem('driverApprovalStatus');
                if (stored) {
                    driverApprovalStatus = JSON.parse(stored);
                    console.log('‚úÖ Loaded driver data from localStorage:', Object.keys(driverApprovalStatus).length, 'drivers');
                }
            } catch (e) {
                console.log('No stored driver data found');
            }
            
            // Function to save driver data to localStorage
            function saveDriverData() {
                try {
                    localStorage.setItem('driverApprovalStatus', JSON.stringify(driverApprovalStatus));
                    console.log('‚úÖ Driver data saved to localStorage');
                } catch (e) {
                    console.error('Failed to save driver data:', e);
                }
            }
            
            // Booking System Data
            let bookings = [];
            try {
                const storedBookings = localStorage.getItem('bookings');
                if (storedBookings) {
                    bookings = JSON.parse(storedBookings);
                    console.log('‚úÖ Loaded bookings from localStorage:', bookings.length, 'bookings');
                }
            } catch (e) {
                console.log('No stored bookings found');
            }
            
            function saveBookings() {
                try {
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    console.log('‚úÖ Bookings saved to localStorage');
                } catch (e) {
                    console.error('Failed to save bookings:', e);
                }
            }
            
            // Customer Data
            let customerData = {};
            try {
                const storedCustomers = localStorage.getItem('customerData');
                if (storedCustomers) {
                    customerData = JSON.parse(storedCustomers);
                    console.log('‚úÖ Loaded customer data from localStorage:', Object.keys(customerData).length, 'customers');
                }
            } catch (e) {
                console.log('No stored customer data found');
            }
            
            function saveCustomerData() {
                try {
                    localStorage.setItem('customerData', JSON.stringify(customerData));
                    console.log('‚úÖ Customer data saved to localStorage');
                } catch (e) {
                    console.error('Failed to save customer data:', e);
                }
            }
            
            // Generate unique booking ID
            function generateBookingId() {
                const timestamp = Date.now();
                const random = Math.floor(Math.random() * 1000);
                return `BK${timestamp}${random}`;
            }
            
            // Check if driver is approved
            function checkDriverApproval(mobile) {
                // Check if driver exists in approval system
                if (driverApprovalStatus[mobile]) {
                    return driverApprovalStatus[mobile].isApproved === true;
                }
                // If not in system, assume pending (newly registered)
                return false;
            }
            
            // Admin function to approve driver (for testing - call from console)
            function approveDriver(mobile) {
                if (driverApprovalStatus[mobile]) {
                    driverApprovalStatus[mobile].isApproved = true;
                    driverApprovalStatus[mobile].approvalStatus = 'approved';
                    driverApprovalStatus[mobile].approvedAt = new Date().toISOString();
                    saveDriverData(); // Save to localStorage
                    console.log('‚úÖ Driver approved:', mobile);
                    alert('‚úÖ Driver ' + mobile + ' has been approved!');
                    return true;
                }
                console.log('‚ùå Driver not found:', mobile);
                alert('‚ùå Driver not found in system');
                return false;
            }
            
            // Admin function to reject driver (for testing - call from console)
            function rejectDriver(mobile, reason) {
                if (driverApprovalStatus[mobile]) {
                    driverApprovalStatus[mobile].isApproved = false;
                    driverApprovalStatus[mobile].approvalStatus = 'rejected';
                    driverApprovalStatus[mobile].rejectionReason = reason || 'Application rejected by admin';
                    driverApprovalStatus[mobile].rejectedAt = new Date().toISOString();
                    saveDriverData(); // Save to localStorage
                    console.log('‚ùå Driver rejected:', mobile);
                    alert('‚ùå Driver ' + mobile + ' has been rejected');
                    return true;
                }
                console.log('‚ùå Driver not found:', mobile);
                alert('‚ùå Driver not found in system');
                return false;
            }
            
            // View all pending drivers (for testing - call from console)
            function viewPendingDrivers() {
                const pending = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'pending')
                    .map(([mobile, driver]) => ({ mobile, ...driver }));
                console.log('Pending Drivers:', pending);
                console.table(pending);
                return pending;
            }
            
            // View all drivers (for testing - call from console)
            function viewAllDrivers() {
                console.log('Total drivers:', Object.keys(driverApprovalStatus).length);
                console.log('Driver data:', driverApprovalStatus);
                console.table(Object.entries(driverApprovalStatus).map(([mobile, driver]) => ({
                    mobile,
                    name: driver.name,
                    status: driver.approvalStatus,
                    registeredAt: driver.registeredAt
                })));
                return driverApprovalStatus;
            }
            
            // Clear all driver data (for testing - call from console)
            function clearAllDrivers() {
                if (confirm('Are you sure you want to clear all driver data?')) {
                    driverApprovalStatus = {};
                    saveDriverData();
                    console.log('‚úÖ All driver data cleared');
                    alert('All driver data has been cleared');
                }
            }
            
            // Show pending approval screen
            function showDriverPendingApproval(mobile) {
                const driverInfo = driverApprovalStatus[mobile] || {};
                const status = driverInfo.approvalStatus || 'pending';
                
                document.getElementById('portalTitle').textContent = '‚è≥ Account Pending Approval';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem 0;">
                        ${status === 'pending' ? `
                            <div style="font-size: 4rem; margin-bottom: 1rem; animation: pulse 2s infinite;">‚è≥</div>
                            <h3 style="color: #ff9800; margin-bottom: 1rem;">Account Pending Approval</h3>
                            <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                                Welcome! Your driver account has been created successfully and is currently under review by our admin team.
                            </p>
                            <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 1.5rem; text-align: left;">
                                <p style="color: #856404; margin: 0 0 0.5rem 0; font-weight: 600;">
                                    üì± Mobile: ${mobile}
                                </p>
                                <p style="color: #856404; margin: 0.5rem 0; font-size: 0.9rem;">
                                    Status: <strong>Pending Review</strong>
                                </p>
                            </div>
                            <div style="background: #e7f3ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #2196F3; margin-bottom: 1.5rem;">
                                <p style="color: #0d47a1; margin: 0 0 0.5rem 0; font-weight: 600;">
                                    What happens next?
                                </p>
                                <p style="color: #0d47a1; margin: 0.5rem 0; font-size: 0.9rem;">
                                    ‚úì Admin will review your application
                                </p>
                                <p style="color: #0d47a1; margin: 0.5rem 0; font-size: 0.9rem;">
                                    ‚úì You will be notified once approved
                                </p>
                                <p style="color: #0d47a1; margin: 0.5rem 0; font-size: 0.9rem;">
                                    ‚úì After approval, you can start accepting rides
                                </p>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">
                                    Need help? Contact admins:
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üìß <a href="mailto:kraja4700@gmail.com" style="color: #667eea;">kraja4700@gmail.com</a> | <a href="mailto:sathishkumar4700@gmail.com" style="color: #667eea;">sathishkumar4700@gmail.com</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üì± <a href="tel:+919962366104" style="color: #667eea;">+91 9962366104</a> | <a href="tel:+918179824281" style="color: #667eea;">+91 8179824281</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üí¨ <a href="https://wa.me/919962366104" target="_blank" style="color: #667eea;">WhatsApp 1</a> | <a href="https://wa.me/918179824281" target="_blank" style="color: #667eea;">WhatsApp 2</a>
                                </p>
                            </div>
                        ` : status === 'rejected' ? `
                            <div style="font-size: 4rem; margin-bottom: 1rem; color: #f44336;">‚ùå</div>
                            <h3 style="color: #f44336; margin-bottom: 1rem;">Application Rejected</h3>
                            <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                                Unfortunately, your driver application has been rejected.
                            </p>
                            ${driverInfo.rejectionReason ? `
                                <div style="background: #ffebee; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #f44336; margin-bottom: 1.5rem; text-align: left;">
                                    <p style="color: #c62828; margin: 0 0 0.5rem 0; font-weight: 600;">
                                        Reason:
                                    </p>
                                    <p style="color: #d32f2f; margin: 0; font-size: 0.9rem;">
                                        ${driverInfo.rejectionReason}
                                    </p>
                                </div>
                            ` : ''}
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">
                                    Contact admins for more information:
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üìß <a href="mailto:kraja4700@gmail.com" style="color: #667eea;">kraja4700@gmail.com</a> | <a href="mailto:sathishkumar4700@gmail.com" style="color: #667eea;">sathishkumar4700@gmail.com</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üì± <a href="tel:+919962366104" style="color: #667eea;">+91 9962366104</a> | <a href="tel:+918179824281" style="color: #667eea;">+91 8179824281</a>
                                </p>
                            </div>
                        ` : ''}
                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            Close
                        </button>
                    </div>
                    <style>
                        @keyframes pulse {
                            0%, 100% { opacity: 1; }
                            50% { opacity: 0.5; }
                        }
                    </style>
                `;
            }

            function handleDriverAuth() {
                const mobile = document.getElementById('driverMobile').value;
                const passwordSection = document.getElementById('driverPasswordSection');
                const authBtn = document.getElementById('driverAuthBtn');
                
                if (!mobile || mobile.length !== 10) {
                    alert('Please enter a valid 10-digit mobile number');
                    return;
                }

                // Step 1: Show password field
                if (passwordSection.style.display === 'none') {
                    passwordSection.style.display = 'block';
                    authBtn.textContent = 'Login';
                    return;
                }

                // Step 2: Verify password and login
                const enteredPassword = document.getElementById('driverPassword').value;
                
                if (!enteredPassword) {
                    alert('Please enter password');
                    return;
                }
                
                // Check if driver exists
                if (!driverApprovalStatus[mobile]) {
                    alert('‚ùå Driver not found. Please register first.');
                    return;
                }
                
                // Check if driver is deactivated
                if (driverApprovalStatus[mobile].approvalStatus === 'deactivated') {
                    alert('‚ö†Ô∏è Your account has been deactivated. Please contact admin.\n\nüìß kraja4700@gmail.com | sathishkumar4700@gmail.com\nüì± +91 9962366104 | +91 8179824281');
                    // Clear password field for security
                    document.getElementById('driverPassword').value = '';
                    return;
                }
                
                // Verify password
                if (driverApprovalStatus[mobile].password !== enteredPassword) {
                    alert('‚ùå Invalid password. Please try again.');
                    return;
                }
                
                // Password verified, show dashboard
                showDriverDashboard(mobile);
            }

            function showDriverDashboard(mobile) {
                // Check if driver is approved
                const isApproved = checkDriverApproval(mobile);
                
                if (!isApproved) {
                    showDriverPendingApproval(mobile);
                    return;
                }
                
                // Set driver status to online on login (if not already set)
                if (!driverApprovalStatus[mobile].driverStatus) {
                    driverApprovalStatus[mobile].driverStatus = 'online';
                    driverApprovalStatus[mobile].lastStatusChange = new Date().toISOString();
                    saveDriverData();
                }
                
                // Get driver info
                const driverInfo = driverApprovalStatus[mobile] || {};
                const driverName = driverInfo.name || 'Driver';
                const currentStatus = driverInfo.driverStatus || 'offline';
                
                // Calculate real-time statistics
                const driverBookings = bookings.filter(b => b.driverPhone === mobile);
                const completedBookings = driverBookings.filter(b => b.status === 'completed');
                
                const today = new Date().toDateString();
                const todayBookings = completedBookings.filter(b => new Date(b.completedAt).toDateString() === today);
                const todayEarnings = todayBookings.reduce((sum, b) => sum + b.amount, 0);
                
                const thisMonth = new Date().getMonth();
                const thisYear = new Date().getFullYear();
                const monthBookings = completedBookings.filter(b => {
                    const date = new Date(b.completedAt);
                    return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
                });
                const monthEarnings = monthBookings.reduce((sum, b) => sum + b.amount, 0);
                
                const ridesToday = todayBookings.length;
                const totalRides = completedBookings.length;
                const rating = totalRides > 0 ? '4.5' : 'N/A';
                
                document.getElementById('portalTitle').textContent = 'üöó Driver Dashboard';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #10ac84 0%, #0e9670 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0 0 0.5rem 0;">Welcome, ${driverName}!</h3>
                            <p style="margin: 0; opacity: 0.9;">Mobile: ${mobile}</p>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">‚úÖ Approved Driver</p>
                            <div style="margin-top: 1rem; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Your Status:</label>
                                <select id="driverStatusSelect" onchange="changeDriverStatus('${mobile}', this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid white; border-radius: 8px; font-size: 1rem; font-weight: 600; background: white; color: #333; cursor: pointer;">
                                    <option value="online" ${currentStatus === 'online' ? 'selected' : ''}>üü¢ Online - Available</option>
                                    <option value="occupied" ${currentStatus === 'occupied' ? 'selected' : ''}>üî¥ Occupied - On a Ride</option>
                                    <option value="offline" ${currentStatus === 'offline' ? 'selected' : ''}>‚ö´ Offline - Not Available</option>
                                </select>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; opacity: 0.9;">
                                    ${currentStatus === 'online' ? 'üü¢ You are visible to customers and can receive ride requests' : 
                                      currentStatus === 'occupied' ? 'üî¥ You are currently on a ride' : 
                                      '‚ö´ You are not available for rides'}
                                </p>
                            </div>
                        </div>

                        <!-- Earnings Summary -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #10ac84;">‚Çπ${todayEarnings}</div>
                                <div style="font-size: 0.85rem; color: #666;">Today's Earnings</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">${ridesToday} rides</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #667eea;">‚Çπ${monthEarnings}</div>
                                <div style="font-size: 0.85rem; color: #666;">This Month</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">${monthBookings.length} rides</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #ffd700;">${totalRides}</div>
                                <div style="font-size: 0.85rem; color: #666;">Total Rides</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">All time</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #ff6b6b;">${rating}‚≠ê</div>
                                <div style="font-size: 0.85rem; color: #666;">Rating</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 0.25rem;">${totalRides > 0 ? 'Avg rating' : 'No rides yet'}</div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;">
                            <button onclick="showAssignedRides()" style="background: #667eea; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üöó Assigned Rides
                            </button>
                            <button onclick="showEarnings()" style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üí∞ View Earnings
                            </button>
                            <button onclick="showRideHistory()" style="background: #764ba2; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üìã Ride History
                            </button>
                            <button onclick="showDriverProfile('${mobile}')" style="background: #ffd700; color: #1a1a2e; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üë§ My Profile
                            </button>
                            <button onclick="showPasswordReset('${mobile}')" style="background: #ff6b6b; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; grid-column: span 2;">
                                üîê Change Password
                            </button>
                        </div>

                        <!-- Status Message -->
                        <div style="background: ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? '#fff3cd' : '#e7f3ff'}; padding: 1.5rem; border-radius: 10px; border-left: 4px solid ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? '#ffc107' : '#2196F3'}; margin-bottom: 1rem; text-align: center;">
                            <p style="color: ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? '#856404' : '#0d47a1'}; margin: 0 0 0.5rem 0; font-weight: 600;">
                                ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? 'üöó You have active rides!' : 'üéâ You\'re all set!'}
                            </p>
                            <p style="color: ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? '#856404' : '#0d47a1'}; margin: 0; font-size: 0.9rem;">
                                ${driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status)).length > 0 ? 'Check your assigned rides to start or complete them.' : 'Your account is approved. New rides will be assigned by admin.'}
                            </p>
                        </div>

                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Logout
                        </button>
                    </div>
                `;
            }

            function toggleAvailability(isAvailable) {
                const status = isAvailable ? 'Available' : 'Unavailable';
                console.log('Driver availability:', status);
                // In production, this would update the database
                alert('‚úÖ Status updated to: ' + status + '\n\nThis will be saved to the backend once connected.');
            }
            
            // Change driver status (online/occupied/offline)
            function changeDriverStatus(mobile, newStatus) {
                if (driverApprovalStatus[mobile]) {
                    const oldStatus = driverApprovalStatus[mobile].driverStatus;
                    driverApprovalStatus[mobile].driverStatus = newStatus;
                    driverApprovalStatus[mobile].lastStatusChange = new Date().toISOString();
                    saveDriverData();
                    
                    const statusMessages = {
                        'online': 'üü¢ You are now ONLINE and available for rides',
                        'occupied': 'üî¥ Status changed to OCCUPIED - Currently on a ride',
                        'offline': '‚ö´ You are now OFFLINE and not available for rides'
                    };
                    
                    notify('Status Updated', statusMessages[newStatus], 'info');
                    console.log(`Driver ${mobile} status changed: ${oldStatus} ‚Üí ${newStatus}`);
                }
            }

            function showAssignedRides() {
                // Get current driver's phone from the dashboard
                const driverPhone = getCurrentDriverPhone();
                if (!driverPhone) {
                    alert('Error: Driver not found');
                    return;
                }
                
                const driverBookings = bookings.filter(b => b.driverPhone === driverPhone);
                const activeRides = driverBookings.filter(b => ['assigned', 'in-progress'].includes(b.status));
                const completedRides = driverBookings.filter(b => b.status === 'completed');
                
                document.getElementById('portalTitle').textContent = 'üöó My Rides';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <!-- Ride Stats -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: #d1ecf1; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0c5460;">${activeRides.length}</div>
                                <div style="font-size: 0.85rem; color: #0c5460;">Active Rides</div>
                            </div>
                            <div style="background: #d4edda; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #155724;">${completedRides.length}</div>
                                <div style="font-size: 0.85rem; color: #155724;">Completed</div>
                            </div>
                        </div>
                        
                        ${activeRides.length === 0 && completedRides.length === 0 ? `
                            <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üöó</div>
                                <h3 style="color: #666; margin-bottom: 1rem;">No Rides Yet</h3>
                                <p style="color: #999;">Rides will appear here when assigned by admin</p>
                            </div>
                        ` : `
                            ${activeRides.length > 0 ? `
                                <h4 style="margin: 0 0 1rem 0; color: #333;">Active Rides</h4>
                                ${activeRides.map(booking => `
                                    <div style="background: white; border: 2px solid ${getStatusColor(booking.status)}; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div>
                                                <strong style="color: #333;">#${booking.id}</strong>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">Customer: ${booking.customerName}</p>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üì± ${booking.customerPhone}</p>
                                            </div>
                                            <span style="background: ${getStatusColor(booking.status)}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                                                ${booking.status.toUpperCase()}
                                            </span>
                                        </div>
                                        <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;">
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Pickup:</strong> ${booking.pickupLocation}</p>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Drop:</strong> ${booking.dropLocation}</p>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üïê Time:</strong> ${new Date(booking.pickupDateTime).toLocaleString()}</p>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üöó Service:</strong> ${booking.serviceType}</p>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üí∞ Amount:</strong> ‚Çπ${booking.amount}</p>
                                            ${booking.notes ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.85rem;"><strong>üìù Notes:</strong> ${booking.notes}</p>` : ''}
                                        </div>
                                        ${booking.status === 'assigned' ? `
                                            <div style="display: grid; grid-template-columns: 1fr; gap: 0.5rem;">
                                                <button onclick="startRide('${booking.id}')" style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                                    Start Ride
                                                </button>
                                            </div>
                                        ` : booking.status === 'in-progress' ? `
                                            <button onclick="completeRide('${booking.id}')" style="width: 100%; background: #4CAF50; color: white; border: none; padding: 0.75rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                                Complete Ride
                                            </button>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            ` : ''}
                            
                            ${completedRides.length > 0 ? `
                                <h4 style="margin: 1.5rem 0 1rem 0; color: #333;">Completed Rides</h4>
                                ${completedRides.slice(0, 5).map(booking => `
                                    <div style="background: white; border: 2px solid #4CAF50; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; opacity: 0.8;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div>
                                                <strong style="color: #333;">#${booking.id}</strong>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">${booking.customerName}</p>
                                            </div>
                                            <span style="background: #4CAF50; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                                                COMPLETED
                                            </span>
                                        </div>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üí∞ Earned: ‚Çπ${booking.amount}</p>
                                        <p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">‚úì ${new Date(booking.completedAt).toLocaleString()}</p>
                                    </div>
                                `).join('')}
                            ` : ''}
                        `}
                        
                        <button onclick="showDriverDashboard()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 1rem;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            // Get current driver phone (helper function)
            function getCurrentDriverPhone() {
                // This is a simple implementation - in production, you'd use proper session management
                const drivers = Object.keys(driverApprovalStatus);
                // For now, return the first approved driver's phone
                // In a real app, you'd track the logged-in driver
                for (let phone of drivers) {
                    if (driverApprovalStatus[phone].approvalStatus === 'approved') {
                        return phone;
                    }
                }
                return null;
            }
            
            // Start Ride
            function startRide(bookingId) {
                if (confirm('Start this ride?')) {
                    const booking = bookings.find(b => b.id === bookingId);
                    if (booking) {
                        booking.status = 'in-progress';
                        booking.startedAt = new Date().toISOString();
                        saveBookings();
                        alert('‚úÖ Ride started! Drive safely.');
                        showAssignedRides();
                    }
                }
            }
            
            // Complete Ride
            function completeRide(bookingId) {
                if (confirm('Mark this ride as completed?')) {
                    const booking = bookings.find(b => b.id === bookingId);
                    if (booking) {
                        booking.status = 'completed';
                        booking.completedAt = new Date().toISOString();
                        saveBookings();
                        alert('‚úÖ Ride completed! Amount: ‚Çπ' + booking.amount);
                        showAssignedRides();
                    }
                }
            }
            
            function showEarnings() {
                document.getElementById('portalTitle').textContent = 'üí∞ My Earnings';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üí∞</div>
                        <h3 style="color: #10ac84; margin-bottom: 1rem;">Earnings & Payments</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Earnings tracking will be available once the booking system is connected.
                        </p>
                        <div style="background: #d4edda; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #10ac84; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #155724; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìå Coming Soon:
                            </p>
                            <p style="color: #155724; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Daily earnings summary</p>
                            <p style="color: #155724; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Monthly earnings report</p>
                            <p style="color: #155724; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Payment history</p>
                            <p style="color: #155724; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Withdrawal requests</p>
                        </div>
                        <button onclick="showDriverDashboard()" style="width: 100%; background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
                return;
            }
            
            function showRideHistory() {
                document.getElementById('portalTitle').textContent = 'üìã Ride History';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üìã</div>
                        <h3 style="color: #764ba2; margin-bottom: 1rem;">Ride History</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Your ride history will appear here once you complete rides.
                        </p>
                        <div style="background: #f3e7ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #764ba2; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #5a2d82; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìå Coming Soon:
                            </p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ View completed rides</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Customer ratings and feedback</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Earnings per ride</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Ride details and routes</p>
                        </div>
                        <button onclick="showDriverDashboard()" style="width: 100%; background: #764ba2; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
                return;
            }
            
            function showDriverProfile(mobile) {
                // Get driver info from driverApprovalStatus
                const driverInfo = driverApprovalStatus[mobile] || {};
                
                document.getElementById('portalTitle').textContent = 'üë§ My Profile';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 0.5rem;">üë§</div>
                            <h3 style="margin: 0;">${driverInfo.name || 'Driver'}</h3>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Driver ID: ${mobile}</p>
                        </div>
                        <form id="driverProfileForm" onsubmit="saveDriverProfile(event, '${mobile}')">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="margin: 0 0 1rem 0;">Personal Information</h4>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Mobile Number</label>
                                    <input type="tel" value="${driverInfo.phone || mobile}" disabled style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; background: #e9ecef;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                                    <input type="email" id="driverProfileEmail" value="${driverInfo.email || ''}" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Address</label>
                                    <textarea id="driverProfileAddress" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; resize: vertical;" rows="2">${driverInfo.address || ''}</textarea>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Vehicle Type</label>
                                    <input type="text" value="${driverInfo.vehicleType || 'N/A'}" disabled style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; background: #e9ecef;">
                                    <small style="color: #666;">Contact admin to change vehicle type</small>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">License Number</label>
                                    <input type="text" value="${driverInfo.licenseNumber || 'N/A'}" disabled style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; background: #e9ecef;">
                                    <small style="color: #666;">Contact admin to change license number</small>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Experience</label>
                                    <input type="text" value="${driverInfo.experience || 'N/A'} years" disabled style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; background: #e9ecef;">
                                </div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="margin: 0 0 1rem 0;">Account Status</h4>
                                <div style="font-size: 0.9rem; color: #666; line-height: 1.8;">
                                    <div>‚úÖ Status: ${driverInfo.approvalStatus || 'Active'}</div>
                                    <div>üìÖ Registered: ${driverInfo.registeredAt ? new Date(driverInfo.registeredAt).toLocaleDateString() : 'N/A'}</div>
                                    <div>‚≠ê Rating: N/A (Backend pending)</div>
                                    <div>üöó Total Rides: 0 (Backend pending)</div>
                                    <div>üí∞ Total Earnings: ‚Çπ0 (Backend pending)</div>
                                </div>
                            </div>
                            <button type="submit" style="width: 100%; background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 0.5rem;">
                                üíæ Save Changes
                            </button>
                            <button type="button" onclick="showDriverDashboard('${mobile}')" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ‚Üê Back to Dashboard
                            </button>
                        </form>
                    </div>
                `;
            }
            
            // Save Driver Profile
            function saveDriverProfile(event, mobile) {
                event.preventDefault();
                
                const email = document.getElementById('driverProfileEmail').value;
                const address = document.getElementById('driverProfileAddress').value;
                
                if (driverApprovalStatus[mobile]) {
                    // Store old values for comparison
                    const oldEmail = driverApprovalStatus[mobile].email;
                    const oldAddress = driverApprovalStatus[mobile].address;
                    
                    // Check if anything changed
                    const hasChanges = (email !== oldEmail) || (address !== oldAddress);
                    
                    if (hasChanges) {
                        // Update profile
                        driverApprovalStatus[mobile].email = email;
                        driverApprovalStatus[mobile].address = address;
                        
                        // Set status back to pending for admin re-approval
                        driverApprovalStatus[mobile].approvalStatus = 'pending';
                        driverApprovalStatus[mobile].isApproved = false;
                        driverApprovalStatus[mobile].profileUpdatedAt = new Date().toISOString();
                        driverApprovalStatus[mobile].requiresReapproval = true;
                        
                        saveDriverData();
                        
                        // Notify admin about profile update
                        notify(
                            'Driver Profile Updated üìù',
                            `${driverApprovalStatus[mobile].name} updated their profile - Requires re-approval`,
                            'warning'
                        );
                        
                        // Show pending approval message
                        document.getElementById('portalTitle').textContent = '‚è≥ Re-Approval Required';
                        document.getElementById('portalContent').innerHTML = `
                            <div style="text-align: center; padding: 2rem 0;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">‚è≥</div>
                                <h3 style="color: #ffc107; margin-bottom: 1rem;">Profile Updated - Pending Re-Approval</h3>
                                <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                                    Your profile has been updated successfully. However, your changes need to be reviewed and approved by an admin before you can access your dashboard again.
                                </p>
                                <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 1.5rem; text-align: left;">
                                    <p style="color: #856404; margin: 0 0 0.5rem 0; font-weight: 600;">
                                        üìã Updated Information:
                                    </p>
                                    <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                        Email: ${email}
                                    </p>
                                    <p style="color: #856404; margin: 0.25rem 0; font-size: 0.9rem;">
                                        Address: ${address}
                                    </p>
                                </div>
                                <div style="background: #e7f3ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #2196F3; margin-bottom: 1.5rem;">
                                    <p style="color: #0d47a1; margin: 0; font-size: 0.95rem;">
                                        ‚è≥ Admin will review your changes. You will be notified once approved.
                                    </p>
                                </div>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                    <p style="color: #666; margin: 0 0 0.5rem 0; font-size: 0.9rem;">
                                        Admins will be notified via:
                                    </p>
                                    <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                        ‚úâÔ∏è Email: kraja4700@gmail.com, sathishkumar4700@gmail.com
                                    </p>
                                    <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                        üí¨ WhatsApp: +91 9962366104, +91 8179824281
                                    </p>
                                </div>
                                <button onclick="closePortal()" style="width: 100%; background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                    ‚úì Done
                                </button>
                            </div>
                        `;
                    } else {
                        // No changes made
                        notify('No Changes', 'No changes were made to your profile', 'info');
                        showDriverDashboard(mobile);
                    }
                }
            }
            
            // Password Reset Function for Driver Dashboard
            function showPasswordReset(mobile) {
                document.getElementById('portalTitle').textContent = 'üîê Change Password';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">üîê</div>
                            <h3 style="margin: 0;">Change Your Password</h3>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">Keep your account secure</p>
                        </div>
                        
                        <form id="passwordResetForm" onsubmit="handlePasswordReset(event, '${mobile}')">
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Current Password *</label>
                                    <input type="password" id="currentPassword" placeholder="Enter current password" required
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">New Password *</label>
                                    <input type="password" id="newPassword" placeholder="Enter new password (min 6 characters)" required minlength="6"
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                    <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">Minimum 6 characters</small>
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Confirm New Password *</label>
                                    <input type="password" id="confirmPassword" placeholder="Re-enter new password" required minlength="6"
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 1rem;">
                                <p style="color: #856404; margin: 0; font-size: 0.9rem;">
                                    <strong>‚ö†Ô∏è Important:</strong> After changing your password, you'll need to use the new password for your next login.
                                </p>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <button type="button" onclick="showDriverDashboard('${mobile}')" 
                                        style="background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    Change Password
                                </button>
                            </div>
                        </form>
                    </div>
                `;
            }
            
            // Handle Password Reset
            function handlePasswordReset(event, mobile) {
                event.preventDefault();
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validate all fields are filled
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert('‚ùå All fields are required');
                    return;
                }
                
                // Validate new password length
                if (newPassword.length < 6) {
                    alert('‚ùå New password must be at least 6 characters long');
                    return;
                }
                
                // Validate passwords match
                if (newPassword !== confirmPassword) {
                    alert('‚ùå New password and confirmation do not match');
                    return;
                }
                
                // Check if driver exists
                if (!driverApprovalStatus[mobile]) {
                    alert('‚ùå Driver not found in system');
                    return;
                }
                
                // Verify current password
                if (driverApprovalStatus[mobile].password !== currentPassword) {
                    alert('‚ùå Current password is incorrect');
                    return;
                }
                
                // Check if new password is same as current
                if (currentPassword === newPassword) {
                    alert('‚ùå New password must be different from current password');
                    return;
                }
                
                // Update password
                driverApprovalStatus[mobile].password = newPassword;
                driverApprovalStatus[mobile].passwordLastChanged = new Date().toISOString();
                
                // Save to localStorage
                saveDriverData();
                
                // Show success message
                alert('‚úÖ Password Changed Successfully!\n\nYour password has been updated.\nPlease use your new password for future logins.');
                
                // Return to dashboard
                showDriverDashboard(mobile);
            }

            function handleCustomerAuth() {
                const mobile = document.getElementById('customerMobile').value;
                const otpSection = document.getElementById('customerOtpSection');
                const authBtn = document.getElementById('customerAuthBtn');
                
                if (!mobile || mobile.length !== 10) {
                    alert('Please enter a valid 10-digit mobile number');
                    return;
                }

                if (otpSection.style.display === 'none') {
                    // Note: Same phone can be customer AND driver AND admin
                    // We only check if already a customer to prevent duplicate customer accounts
                    
                    // Generate and send OTP
                    const otp = generateOTP();
                    generatedOTPs['customer_' + mobile] = otp;
                    
                    otpSection.style.display = 'block';
                    document.getElementById('customerOtpDisplay').textContent = 'üì± OTP sent to ' + mobile + ': ' + otp;
                    authBtn.textContent = 'Verify OTP & Login';
                    
                    console.log('Customer OTP for ' + mobile + ': ' + otp);
                } else {
                    // Verify OTP
                    const enteredOtp = document.getElementById('customerOtp').value;
                    const correctOtp = generatedOTPs['customer_' + mobile];
                    
                    if (enteredOtp === correctOtp) {
                        // Store customer info if new
                        if (!customerData[mobile]) {
                            customerData[mobile] = {
                                phone: mobile,
                                name: '',
                                email: '',
                                registeredAt: new Date().toISOString(),
                                totalBookings: 0
                            };
                            saveCustomerData();
                        }
                        
                        // Show customer dashboard
                        showCustomerDashboard(mobile);
                    } else {
                        alert('‚ùå Invalid OTP. Please try again.');
                    }
                }
            }
            
            // Customer Dashboard
            function showCustomerDashboard(mobile) {
                const customer = customerData[mobile] || { phone: mobile, name: 'Customer', totalBookings: 0 };
                const customerBookings = bookings.filter(b => b.customerPhone === mobile);
                const activeBookings = customerBookings.filter(b => ['pending', 'assigned', 'in-progress'].includes(b.status));
                const completedBookings = customerBookings.filter(b => b.status === 'completed');
                
                document.getElementById('portalTitle').textContent = 'üë§ Customer Dashboard';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0 0 0.5rem 0;">Welcome, ${customer.name || 'Customer'}!</h3>
                            <p style="margin: 0; opacity: 0.9;">Mobile: ${mobile}</p>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">Total Bookings: ${customer.totalBookings}</p>
                        </div>

                        <!-- Quick Stats -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #ff9800;">${activeBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #666;">Active Rides</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #10ac84;">${completedBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #666;">Completed</div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="display: grid; grid-template-columns: 1fr; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <button onclick="showNewBookingForm('${mobile}')" style="background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1.1rem;">
                                üöó Book a Driver Now
                            </button>
                            <button onclick="showCustomerBookings('${mobile}')" style="background: #667eea; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üìã My Bookings
                            </button>
                            <button onclick="showCustomerProfile('${mobile}')" style="background: #764ba2; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üë§ My Profile
                            </button>
                        </div>

                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Logout
                        </button>
                    </div>
                `;
            }

            // New Booking Form
            function showNewBookingForm(mobile) {
                document.getElementById('portalTitle').textContent = 'üöó Book a Driver';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #10ac84 0%, #0e9670 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">üöó</div>
                            <h3 style="margin: 0;">Book Your Driver</h3>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">Fill in the details below</p>
                        </div>
                        
                        <form id="bookingForm" onsubmit="handleBookingSubmit(event, '${mobile}')">
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Your Name *</label>
                                    <input type="text" id="customerName" placeholder="Enter your name" required
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Pickup Location *</label>
                                    <input type="text" id="pickupLocation" placeholder="Enter pickup address" required
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Drop Location *</label>
                                    <input type="text" id="dropLocation" placeholder="Enter drop address" required
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Pickup Date & Time *</label>
                                    <input type="datetime-local" id="pickupDateTime" required
                                           style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Service Type *</label>
                                    <select id="serviceType" required
                                            style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                        <option value="">Select service type</option>
                                        <option value="hourly">Hourly</option>
                                        <option value="airport">Airport Transfer</option>
                                        <option value="outstation">Outstation</option>
                                        <option value="full-day">Full Day</option>
                                    </select>
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Additional Notes</label>
                                    <textarea id="notes" placeholder="Any special requirements..." rows="3"
                                              style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical;"></textarea>
                                </div>
                            </div>
                            
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #2196F3; margin-bottom: 1rem;">
                                <p style="color: #0d47a1; margin: 0; font-size: 0.9rem;">
                                    <strong>üìå Note:</strong> Your booking will be assigned to an available driver. You'll receive confirmation shortly.
                                </p>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <button type="button" onclick="showCustomerDashboard('${mobile}')" 
                                        style="background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    Book Now
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                
                // Set minimum datetime to now
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('pickupDateTime').min = now.toISOString().slice(0, 16);
            }
            
            // Handle Booking Submission
            function handleBookingSubmit(event, mobile) {
                event.preventDefault();
                
                const customerName = document.getElementById('customerName').value;
                const pickupLocation = document.getElementById('pickupLocation').value;
                const dropLocation = document.getElementById('dropLocation').value;
                const pickupDateTime = document.getElementById('pickupDateTime').value;
                const serviceType = document.getElementById('serviceType').value;
                const notes = document.getElementById('notes').value;
                
                // Create booking object
                const booking = {
                    id: generateBookingId(),
                    customerPhone: mobile,
                    customerName: customerName,
                    pickupLocation: pickupLocation,
                    dropLocation: dropLocation,
                    pickupDateTime: pickupDateTime,
                    serviceType: serviceType,
                    notes: notes,
                    status: 'pending', // pending, assigned, in-progress, completed, cancelled
                    driverPhone: null,
                    driverName: null,
                    createdAt: new Date().toISOString(),
                    assignedAt: null,
                    completedAt: null,
                    amount: calculateBookingAmount(serviceType)
                };
                
                // Add to bookings array
                bookings.push(booking);
                saveBookings();
                
                // Update customer data
                if (customerData[mobile]) {
                    customerData[mobile].name = customerName;
                    customerData[mobile].totalBookings = (customerData[mobile].totalBookings || 0) + 1;
                    saveCustomerData();
                }
                
                // Send notification to admin (simulated - will show to anyone viewing the page)
                notify(
                    'New Booking Request üöó',
                    `${customerName} requested a ride from ${pickupLocation}`,
                    'booking'
                );
                
                alert('‚úÖ Booking Created Successfully!\n\nBooking ID: ' + booking.id + '\n\nYour booking has been submitted. A driver will be assigned shortly.');
                showCustomerDashboard(mobile);
            }
            
            // Calculate booking amount based on service type
            function calculateBookingAmount(serviceType) {
                const rates = {
                    'hourly': 200,
                    'airport': 500,
                    'outstation': 500, // Base amount, actual will be calculated based on distance
                    'full-day': 2000
                };
                return rates[serviceType] || 0;
            }
            
            // Show Customer Bookings
            function showCustomerBookings(mobile) {
                const customerBookings = bookings.filter(b => b.customerPhone === mobile);
                
                document.getElementById('portalTitle').textContent = 'üìã My Bookings';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        ${customerBookings.length === 0 ? `
                            <div style="text-align: center; padding: 3rem;">
                                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üìã</div>
                                <h3 style="color: #666; margin-bottom: 1rem;">No Bookings Yet</h3>
                                <p style="color: #999; margin-bottom: 1.5rem;">Book your first driver to get started!</p>
                                <button onclick="showNewBookingForm('${mobile}')" style="background: #10ac84; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                    üöó Book a Driver
                                </button>
                            </div>
                        ` : customerBookings.map(booking => `
                            <div style="background: white; border: 2px solid ${getStatusColor(booking.status)}; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                    <div>
                                        <strong style="color: #333;">#${booking.id}</strong>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">${new Date(booking.createdAt).toLocaleString()}</p>
                                    </div>
                                    <span style="background: ${getStatusColor(booking.status)}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                                        ${booking.status.toUpperCase()}
                                    </span>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;">
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Pickup:</strong> ${booking.pickupLocation}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Drop:</strong> ${booking.dropLocation}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üïê Time:</strong> ${new Date(booking.pickupDateTime).toLocaleString()}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üöó Service:</strong> ${booking.serviceType}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üí∞ Amount:</strong> ‚Çπ${booking.amount}</p>
                                    ${booking.driverName ? `<p style="margin: 0.25rem 0; color: #10ac84; font-size: 0.9rem;"><strong>üë§ Driver:</strong> ${booking.driverName} (${booking.driverPhone})</p>` : ''}
                                </div>
                                ${booking.status === 'pending' ? `
                                    <button onclick="cancelBooking('${booking.id}', '${mobile}')" style="width: 100%; background: #ff6b6b; color: white; border: none; padding: 0.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                                        Cancel Booking
                                    </button>
                                ` : ''}
                            </div>
                        `).join('')}
                        
                        <button onclick="showCustomerDashboard('${mobile}')" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 1rem;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            // Get status color
            function getStatusColor(status) {
                const colors = {
                    'pending': '#ff9800',
                    'assigned': '#2196F3',
                    'in-progress': '#10ac84',
                    'completed': '#4CAF50',
                    'cancelled': '#ff6b6b'
                };
                return colors[status] || '#999';
            }
            
            // Cancel Booking
            function cancelBooking(bookingId, mobile) {
                if (confirm('Are you sure you want to cancel this booking?')) {
                    const booking = bookings.find(b => b.id === bookingId);
                    if (booking) {
                        booking.status = 'cancelled';
                        booking.cancelledAt = new Date().toISOString();
                        saveBookings();
                        alert('‚úÖ Booking cancelled successfully');
                        showCustomerBookings(mobile);
                    }
                }
            }
            
            // Show Customer Profile
            function showCustomerProfile(mobile) {
                const customer = customerData[mobile] || { phone: mobile, name: '', email: '' };
                
                document.getElementById('portalTitle').textContent = 'üë§ My Profile';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 0.5rem;">üë§</div>
                            <h3 style="margin: 0;">${customer.name || 'Customer'}</h3>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Customer ID: ${mobile}</p>
                        </div>
                        <form id="customerProfileForm" onsubmit="saveCustomerProfile(event, '${mobile}')">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="margin: 0 0 1rem 0;">Personal Information</h4>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Mobile Number</label>
                                    <input type="tel" value="${mobile}" disabled style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; background: #e9ecef;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Name *</label>
                                    <input type="text" id="custProfileName" value="${customer.name || ''}" required style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                                    <input type="email" id="custProfileEmail" value="${customer.email || ''}" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px;">
                                </div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="margin: 0 0 1rem 0;">Booking Statistics</h4>
                                <div style="font-size: 0.9rem; color: #666; line-height: 1.8;">
                                    <div>üìÖ Registered: ${customer.registeredAt ? new Date(customer.registeredAt).toLocaleDateString() : 'N/A'}</div>
                                    <div>üöó Total Bookings: ${customer.totalBookings || 0}</div>
                                </div>
                            </div>
                            <button type="submit" style="width: 100%; background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 0.5rem;">
                                üíæ Save Changes
                            </button>
                            <button type="button" onclick="showCustomerDashboard('${mobile}')" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ‚Üê Back to Dashboard
                            </button>
                        </form>
                    </div>
                `;
            }
            
            // Save Customer Profile
            function saveCustomerProfile(event, mobile) {
                event.preventDefault();
                
                const name = document.getElementById('custProfileName').value;
                const email = document.getElementById('custProfileEmail').value;
                
                if (!customerData[mobile]) {
                    customerData[mobile] = { phone: mobile };
                }
                
                customerData[mobile].name = name;
                customerData[mobile].email = email;
                saveCustomerData();
                
                notify('Profile Updated ‚úÖ', 'Your profile has been updated successfully', 'success');
                showCustomerDashboard(mobile);
            }

            // Admin Dashboard Functions
            function showBookings() {
                const pendingBookings = bookings.filter(b => b.status === 'pending');
                const assignedBookings = bookings.filter(b => b.status === 'assigned');
                const inProgressBookings = bookings.filter(b => b.status === 'in-progress');
                const completedBookings = bookings.filter(b => b.status === 'completed');
                
                document.getElementById('portalTitle').textContent = 'üìã All Bookings';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <!-- Booking Stats -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;">
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #856404;">${pendingBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #856404;">Pending</div>
                            </div>
                            <div style="background: #d1ecf1; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0c5460;">${assignedBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #0c5460;">Assigned</div>
                            </div>
                            <div style="background: #d4edda; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #155724;">${inProgressBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #155724;">In Progress</div>
                            </div>
                            <div style="background: #d4edda; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #155724;">${completedBookings.length}</div>
                                <div style="font-size: 0.85rem; color: #155724;">Completed</div>
                            </div>
                        </div>
                        
                        ${bookings.length === 0 ? `
                            <div style="text-align: center; padding: 2rem; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;">üìã</div>
                                <p style="color: #666; margin: 0;">No bookings yet</p>
                            </div>
                        ` : bookings.slice().reverse().map(booking => `
                            <div style="background: white; border: 2px solid ${getStatusColor(booking.status)}; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 0.5rem;">
                                    <div>
                                        <strong style="color: #333;">#${booking.id}</strong>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">Customer: ${booking.customerName} (${booking.customerPhone})</p>
                                    </div>
                                    <span style="background: ${getStatusColor(booking.status)}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                                        ${booking.status.toUpperCase()}
                                    </span>
                                </div>
                                <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;">
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Pickup:</strong> ${booking.pickupLocation}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üìç Drop:</strong> ${booking.dropLocation}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üïê Time:</strong> ${new Date(booking.pickupDateTime).toLocaleString()}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üöó Service:</strong> ${booking.serviceType}</p>
                                    <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>üí∞ Amount:</strong> ‚Çπ${booking.amount}</p>
                                    ${booking.driverName ? `<p style="margin: 0.25rem 0; color: #10ac84; font-size: 0.9rem;"><strong>üë§ Driver:</strong> ${booking.driverName} (${booking.driverPhone})</p>` : ''}
                                    ${booking.notes ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.85rem;"><strong>üìù Notes:</strong> ${booking.notes}</p>` : ''}
                                </div>
                                ${booking.status === 'pending' ? `
                                    <button onclick="assignDriverToBooking('${booking.id}')" style="width: 100%; background: #10ac84; color: white; border: none; padding: 0.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                                        Assign Driver
                                    </button>
                                ` : ''}
                            </div>
                        `).join('')}
                        
                        <button onclick="showAdminDashboard('${Object.keys(superAdmins)[0]}')" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 1rem;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            // Assign Driver to Booking
            function assignDriverToBooking(bookingId) {
                const booking = bookings.find(b => b.id === bookingId);
                if (!booking) return;
                
                // Get approved drivers
                const approvedDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'approved')
                    .map(([mobile, driver]) => ({ mobile, ...driver }));
                
                if (approvedDrivers.length === 0) {
                    alert('‚ùå No approved drivers available');
                    return;
                }
                
                document.getElementById('portalTitle').textContent = 'üöó Assign Driver';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 0.5rem 0;">Booking Details</h4>
                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>ID:</strong> #${booking.id}</p>
                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Customer:</strong> ${booking.customerName}</p>
                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Pickup:</strong> ${booking.pickupLocation}</p>
                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Drop:</strong> ${booking.dropLocation}</p>
                        </div>
                        
                        <h4 style="margin: 0 0 1rem 0;">Select Driver:</h4>
                        ${approvedDrivers.map(driver => `
                            <div onclick="confirmDriverAssignment('${bookingId}', '${driver.phone}', '${driver.name}')" 
                                 style="background: white; border: 2px solid #ddd; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.3s;"
                                 onmouseover="this.style.borderColor='#10ac84'; this.style.background='#f0fff4';"
                                 onmouseout="this.style.borderColor='#ddd'; this.style.background='white';">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong style="color: #333;">${driver.name}</strong>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üì± ${driver.phone}</p>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üöó ${driver.vehicleType}</p>
                                    </div>
                                    <span style="color: #10ac84; font-size: 1.5rem;">‚Üí</span>
                                </div>
                            </div>
                        `).join('')}
                        
                        <button onclick="showBookings()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 1rem;">
                            Cancel
                        </button>
                    </div>
                `;
            }
            
            // Confirm Driver Assignment
            function confirmDriverAssignment(bookingId, driverPhone, driverName) {
                if (confirm(`Assign ${driverName} to this booking?`)) {
                    const booking = bookings.find(b => b.id === bookingId);
                    if (booking) {
                        booking.status = 'assigned';
                        booking.driverPhone = driverPhone;
                        booking.driverName = driverName;
                        booking.assignedAt = new Date().toISOString();
                        saveBookings();
                        alert('‚úÖ Driver assigned successfully!');
                        showBookings();
                    }
                }
            }

            function showCustomers() {
                document.getElementById('portalTitle').textContent = 'üë• Manage Customers';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üë•</div>
                        <h3 style="color: #764ba2; margin-bottom: 1rem;">Customer Management</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Customer management will be available once the backend is connected.
                        </p>
                        <div style="background: #f3e7ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #764ba2; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #5a2d82; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìå Coming Soon:
                            </p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ View all customers</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Customer booking history</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Customer ratings</p>
                            <p style="color: #5a2d82; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Contact information</p>
                        </div>
                        <button onclick="showAdminDashboard('${Object.keys(superAdmins)[0]}')" style="width: 100%; background: #764ba2; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            function showDriverStatus() {
                // Get all approved drivers and sort by status
                const allDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'approved')
                    .map(([mobile, driver]) => ({ mobile, ...driver }))
                    .sort((a, b) => {
                        // Sort by status: online first, then occupied, then offline
                        const statusOrder = { 'online': 1, 'occupied': 2, 'offline': 3 };
                        const aStatus = statusOrder[a.driverStatus] || 3;
                        const bStatus = statusOrder[b.driverStatus] || 3;
                        return aStatus - bStatus;
                    });
                
                const onlineDrivers = allDrivers.filter(d => d.driverStatus === 'online');
                const occupiedDrivers = allDrivers.filter(d => d.driverStatus === 'occupied');
                const offlineDrivers = allDrivers.filter(d => d.driverStatus === 'offline' || !d.driverStatus);
                
                document.getElementById('portalTitle').textContent = 'üìä Driver Status';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <!-- Summary Stats -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: #d4edda; padding: 1rem; border-radius: 8px; text-align: center; border-left: 4px solid #10ac84;">
                                <div style="font-size: 2rem; font-weight: bold; color: #10ac84;">${onlineDrivers.length}</div>
                                <div style="font-size: 0.85rem; color: #155724;">üü¢ Online</div>
                            </div>
                            <div style="background: #f8d7da; padding: 1rem; border-radius: 8px; text-align: center; border-left: 4px solid #ff6b6b;">
                                <div style="font-size: 2rem; font-weight: bold; color: #ff6b6b;">${occupiedDrivers.length}</div>
                                <div style="font-size: 0.85rem; color: #721c24;">üî¥ Occupied</div>
                            </div>
                            <div style="background: #e2e3e5; padding: 1rem; border-radius: 8px; text-align: center; border-left: 4px solid #6c757d;">
                                <div style="font-size: 2rem; font-weight: bold; color: #6c757d;">${offlineDrivers.length}</div>
                                <div style="font-size: 0.85rem; color: #383d41;">‚ö´ Offline</div>
                            </div>
                        </div>
                        
                        <!-- Online Drivers -->
                        ${onlineDrivers.length > 0 ? `
                            <div style="background: #d4edda; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #10ac84;">
                                <h3 style="margin: 0 0 1rem 0; color: #155724;">üü¢ Online Drivers (${onlineDrivers.length})</h3>
                                ${onlineDrivers.map(driver => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                                            <div style="flex: 1; min-width: 200px;">
                                                <h4 style="margin: 0 0 0.5rem 0; color: #333; font-size: 1.1rem;">${driver.name}</h4>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üìç ${driver.address || 'Address not provided'}</p>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üöó ${driver.vehicleType || 'N/A'} | ${driver.experience || 0} years exp</p>
                                                ${driver.lastStatusChange ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">Last update: ${new Date(driver.lastStatusChange).toLocaleString()}</p>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="background: #10ac84; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">üü¢ Online</span>
                                                <a href="tel:${driver.phone}" style="background: #25D366; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem;">
                                                    üìû ${driver.phone}
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Occupied Drivers -->
                        ${occupiedDrivers.length > 0 ? `
                            <div style="background: #f8d7da; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ff6b6b;">
                                <h3 style="margin: 0 0 1rem 0; color: #721c24;">üî¥ Occupied Drivers (${occupiedDrivers.length})</h3>
                                ${occupiedDrivers.map(driver => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                                            <div style="flex: 1; min-width: 200px;">
                                                <h4 style="margin: 0 0 0.5rem 0; color: #333; font-size: 1.1rem;">${driver.name}</h4>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üìç ${driver.address || 'Address not provided'}</p>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üöó ${driver.vehicleType || 'N/A'} | ${driver.experience || 0} years exp</p>
                                                ${driver.lastStatusChange ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">Last update: ${new Date(driver.lastStatusChange).toLocaleString()}</p>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="background: #ff6b6b; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">üî¥ Occupied</span>
                                                <a href="tel:${driver.phone}" style="background: #25D366; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem;">
                                                    üìû ${driver.phone}
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Offline Drivers -->
                        ${offlineDrivers.length > 0 ? `
                            <div style="background: #e2e3e5; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #6c757d;">
                                <h3 style="margin: 0 0 1rem 0; color: #383d41;">‚ö´ Offline Drivers (${offlineDrivers.length})</h3>
                                ${offlineDrivers.map(driver => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                                            <div style="flex: 1; min-width: 200px;">
                                                <h4 style="margin: 0 0 0.5rem 0; color: #333; font-size: 1.1rem;">${driver.name}</h4>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üìç ${driver.address || 'Address not provided'}</p>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üöó ${driver.vehicleType || 'N/A'} | ${driver.experience || 0} years exp</p>
                                                ${driver.lastStatusChange ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">Last update: ${new Date(driver.lastStatusChange).toLocaleString()}</p>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="background: #6c757d; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">‚ö´ Offline</span>
                                                <a href="tel:${driver.phone}" style="background: #25D366; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem;">
                                                    üìû ${driver.phone}
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${allDrivers.length === 0 ? `
                            <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üöó</div>
                                <h3 style="color: #666; margin-bottom: 0.5rem;">No Approved Drivers</h3>
                                <p style="color: #999;">Drivers will appear here once they are approved</p>
                            </div>
                        ` : ''}
                        
                        <button onclick="showAdminDashboard()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            function showReports() {
                document.getElementById('portalTitle').textContent = 'üìä View Reports';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üìä</div>
                        <h3 style="color: #4ecdc4; margin-bottom: 1rem;">Reports & Analytics</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Reports and analytics will be available once the backend is connected.
                        </p>
                        <div style="background: #e6f9f7; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #4ecdc4; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #2c7a7b; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìå Coming Soon:
                            </p>
                            <p style="color: #2c7a7b; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Revenue reports</p>
                            <p style="color: #2c7a7b; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Driver performance</p>
                            <p style="color: #2c7a7b; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Booking trends</p>
                            <p style="color: #2c7a7b; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Customer analytics</p>
                        </div>
                        <button onclick="showAdminDashboard('${Object.keys(superAdmins)[0]}')" style="width: 100%; background: #4ecdc4; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            function assignRide() {
                document.getElementById('portalTitle').textContent = 'üéØ Assign Rides';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">üéØ</div>
                        <h3 style="color: #9b59b6; margin-bottom: 1rem;">Assign Rides to Drivers</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Ride assignment will be available once the backend is connected.
                        </p>
                        <div style="background: #f4e6ff; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #9b59b6; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #6c2d91; margin: 0 0 0.5rem 0; font-weight: 600;">
                                üìå Coming Soon:
                            </p>
                            <p style="color: #6c2d91; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ View unassigned bookings</p>
                            <p style="color: #6c2d91; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ See available drivers</p>
                            <p style="color: #6c2d91; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Assign drivers to rides</p>
                            <p style="color: #6c2d91; margin: 0.25rem 0; font-size: 0.9rem;">‚Ä¢ Track assignment status</p>
                        </div>
                        <button onclick="showAdminDashboard('${Object.keys(superAdmins)[0]}')" style="width: 100%; background: #9b59b6; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }

            function closePortal() {
                document.getElementById('portalModal').style.display = 'none';
            }
            
            // Export All Data (for syncing across devices)
            function exportAllData() {
                const allData = {
                    driverApprovalStatus: driverApprovalStatus,
                    bookings: bookings,
                    customerData: customerData,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `top-first-call-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('‚úÖ Data exported successfully!\n\nFile downloaded. Use this file to import data on other devices.');
            }
            
            // Import All Data (for syncing across devices)
            function importAllData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'application/json';
                
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            
                            // Validate data structure
                            if (!importedData.version || !importedData.driverApprovalStatus) {
                                alert('‚ùå Invalid data file format');
                                return;
                            }
                            
                            // Confirm before overwriting
                            const driverCount = Object.keys(importedData.driverApprovalStatus || {}).length;
                            const bookingCount = (importedData.bookings || []).length;
                            const customerCount = Object.keys(importedData.customerData || {}).length;
                            
                            const confirmMsg = `‚ö†Ô∏è Import Data?\n\nThis will replace current data with:\n\n` +
                                `‚Ä¢ ${driverCount} drivers\n` +
                                `‚Ä¢ ${bookingCount} bookings\n` +
                                `‚Ä¢ ${customerCount} customers\n\n` +
                                `Current data will be overwritten. Continue?`;
                            
                            if (!confirm(confirmMsg)) return;
                            
                            // Import data
                            driverApprovalStatus = importedData.driverApprovalStatus || {};
                            bookings = importedData.bookings || [];
                            customerData = importedData.customerData || {};
                            
                            // Save to localStorage
                            saveDriverData();
                            saveBookings();
                            saveCustomerData();
                            
                            alert('‚úÖ Data imported successfully!\n\nAll data has been synced from the imported file.');
                            
                            // Refresh dashboard
                            location.reload();
                        } catch (error) {
                            alert('‚ùå Error importing data: ' + error.message);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }

            // Unified Create Account Function
            function openCreateAccount() {
                document.getElementById('portalTitle').textContent = '‚ú® Create Account';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <p style="color: #666; margin-bottom: 1.5rem;">Select your account type:</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <button onclick="showDriverRegistration()" style="padding: 2rem 1rem; background: linear-gradient(135deg, #10ac84, #0e9670); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 3rem; margin-bottom: 0.5rem;">üöó</div>
                                <div>Driver Account</div>
                                <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 0.5rem;">Register as a driver</div>
                            </button>
                            <button onclick="openCustomerRegistration()" style="padding: 2rem 1rem; background: linear-gradient(135deg, #764ba2, #667eea); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 3rem; margin-bottom: 0.5rem;">üë§</div>
                                <div>Customer Account</div>
                                <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 0.5rem;">Book drivers easily</div>
                            </button>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button onclick="openAdminRegistration()" style="width: 100%; padding: 1rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üë®‚Äçüíº Admin Account Request
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            // Unified Login Function
            function openLogin() {
                document.getElementById('portalTitle').textContent = 'üîê Login';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <p style="color: #666; margin-bottom: 1.5rem;">Select your account type:</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                            <button onclick="openAdminPortal()" style="padding: 1.5rem 0.5rem; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë®‚Äçüíº</div>
                                <div style="font-size: 0.9rem;">Admin</div>
                            </button>
                            <button onclick="openDriverPortal()" style="padding: 1.5rem 0.5rem; background: #10ac84; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üöó</div>
                                <div style="font-size: 0.9rem;">Driver</div>
                            </button>
                            <button onclick="openCustomerPortal()" style="padding: 1.5rem 0.5rem; background: #764ba2; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë§</div>
                                <div style="font-size: 0.9rem;">Customer</div>
                            </button>
                        </div>
                        <p style="color: #999; font-size: 0.9rem; margin-top: 1rem;">
                            Don't have an account? <a href="#" onclick="openCreateAccount(); return false;" style="color: #667eea; font-weight: 600; text-decoration: none;">Create one</a>
                        </p>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            // Customer Registration Function
            function openCustomerRegistration() {
                document.getElementById('portalTitle').textContent = 'üë§ Customer Registration';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <form id="customerRegistrationForm" onsubmit="handleCustomerRegistration(event)">
                            <div style="margin-bottom: 1rem;">
                                <input type="text" id="custName" placeholder="Full Name *" required
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="tel" id="custPhone" placeholder="Phone Number *" required maxlength="10"
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="email" id="custEmail" placeholder="Email *" required
                                       style="width: 100%; padding: 0.8rem; margin-bottom: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                                <input type="password" id="custPassword" placeholder="Password *" required minlength="6"
                                       style="width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem;">
                            </div>
                            <button type="submit" style="width: 100%; background: linear-gradient(135deg, #764ba2, #667eea); color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; margin-bottom: 0.75rem;">
                                ‚úì Create Customer Account
                            </button>
                            <button type="button" onclick="openCreateAccount()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ‚Üê Back
                            </button>
                        </form>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            // Admin Registration Request Function
            function openAdminRegistration() {
                document.getElementById('portalTitle').textContent = 'üë®‚Äçüíº Admin Account Request';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 1rem 0;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üë®‚Äçüíº</div>
                        <h3 style="color: #667eea; margin-bottom: 1rem;">Request Admin Access</h3>
                        <p style="color: #666; line-height: 1.6; margin-bottom: 1.5rem;">
                            Admin accounts require approval. Please contact the super admin to request access.
                        </p>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #333; margin: 0.5rem 0; font-size: 0.95rem;">
                                <strong>Contact Super Admins:</strong>
                            </p>
                            <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                <p style="color: #666; margin: 0.5rem 0; font-size: 0.9rem; font-weight: 600;">
                                    Admin 1:
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üìß <a href="mailto:kraja4700@gmail.com" style="color: #667eea;">kraja4700@gmail.com</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üì± <a href="tel:+919962366104" style="color: #667eea;">+91 9962366104</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üí¨ <a href="https://wa.me/919962366104?text=Hi%2C%20I%20would%20like%20to%20request%20admin%20access" target="_blank" style="color: #667eea;">WhatsApp</a>
                                </p>
                            </div>
                            <div>
                                <p style="color: #666; margin: 0.5rem 0; font-size: 0.9rem; font-weight: 600;">
                                    Admin 2:
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üìß <a href="mailto:sathishkumar4700@gmail.com" style="color: #667eea;">sathishkumar4700@gmail.com</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üì± <a href="tel:+918179824281" style="color: #667eea;">+91 8179824281</a>
                                </p>
                                <p style="color: #666; margin: 0.25rem 0; font-size: 0.9rem;">
                                    üí¨ <a href="https://wa.me/918179824281?text=Hi%2C%20I%20would%20like%20to%20request%20admin%20access" target="_blank" style="color: #667eea;">WhatsApp</a>
                                </p>
                            </div>
                        </div>
                        <button onclick="openCreateAccount()" style="width: 100%; background: #667eea; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚Üê Back to Account Types
                        </button>
                    </div>
                `;
                document.getElementById('portalModal').style.display = 'flex';
            }

            // Handle Customer Registration
            function handleCustomerRegistration(event) {
                event.preventDefault();
                
                const formData = {
                    name: document.getElementById('custName').value,
                    phone: document.getElementById('custPhone').value,
                    email: document.getElementById('custEmail').value,
                    password: document.getElementById('custPassword').value,
                    role: 'customer'
                };

                // Check for duplicate customer registration (same phone cannot register as customer twice)
                if (customerData[formData.phone]) {
                    alert('‚ùå This phone number is already registered as a customer.\n\nPlease login to your customer account instead.');
                    return;
                }

                // Store customer data
                customerData[formData.phone] = {
                    name: formData.name,
                    phone: formData.phone,
                    email: formData.email,
                    password: formData.password,
                    registeredAt: new Date().toISOString(),
                    totalBookings: 0
                };
                saveCustomerData();

                // Customer registration complete

                // Show success message
                document.getElementById('portalTitle').textContent = '‚úì Registration Successful!';
                document.getElementById('portalContent').innerHTML = `
                    <div style="text-align: center; padding: 2rem 0;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; animation: scaleIn 0.5s ease-out;">‚úì</div>
                        <h3 style="color: #764ba2; margin-bottom: 1rem;">Account Created!</h3>
                        <p style="color: #666; line-height: 1.8; margin-bottom: 1.5rem;">
                            Your customer account has been created successfully.
                        </p>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: left;">
                            <p style="color: #333; margin: 0.5rem 0;"><strong>Name:</strong> ${formData.name}</p>
                            <p style="color: #333; margin: 0.5rem 0;"><strong>Email:</strong> ${formData.email}</p>
                            <p style="color: #333; margin: 0.5rem 0;"><strong>Phone:</strong> ${formData.phone}</p>
                        </div>
                        <button onclick="openLogin()" style="width: 100%; background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 0.5rem;">
                            Go to Login
                        </button>
                        <button onclick="closePortal()" style="width: 100%; background: #6c757d; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Close
                        </button>
                    </div>
                    <style>
                        @keyframes scaleIn {
                            from { transform: scale(0); }
                            to { transform: scale(1); }
                        }
                    </style>
                `;

                console.log('Customer Registration Data:', formData);
            }

            // Admin Request Management (Super Admin Only)
            function showPendingAdminRequests() {
                const pendingRequests = Object.entries(pendingAdminRequests)
                    .filter(([_, req]) => req.status === 'pending')
                    .map(([mobile, req]) => ({ mobile, ...req }));
                
                const approvedRequests = Object.entries(pendingAdminRequests)
                    .filter(([_, req]) => req.status === 'approved')
                    .map(([mobile, req]) => ({ mobile, ...req }));
                
                const rejectedRequests = Object.entries(pendingAdminRequests)
                    .filter(([_, req]) => req.status === 'rejected')
                    .map(([mobile, req]) => ({ mobile, ...req }));
                
                document.getElementById('portalTitle').textContent = 'üë®‚Äçüíº Manage Admin Requests';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <!-- Pending Admin Requests -->
                        <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ffc107;">
                            <h3 style="margin: 0 0 1rem 0; color: #856404;">‚è≥ Pending Admin Requests (${pendingRequests.length})</h3>
                            ${pendingRequests.length === 0 ? `
                                <p style="color: #856404; margin: 0; font-size: 0.9rem;">No pending admin requests</p>
                            ` : pendingRequests.map(req => `
                                <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                        <div>
                                            <h4 style="margin: 0 0 0.5rem 0; color: #333;">Admin Request</h4>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üì± ${req.mobile}</p>
                                            <p style="margin: 0.25rem 0; color: #999; font-size: 0.85rem;">‚è∞ ${new Date(req.requestedAt).toLocaleString()}</p>
                                        </div>
                                        <span style="background: #ffc107; color: #856404; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Pending</span>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                        <button onclick="approveAdminFromDashboard('${req.mobile}')" 
                                                style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            ‚úì Approve Admin
                                        </button>
                                        <button onclick="rejectAdminFromDashboard('${req.mobile}')" 
                                                style="background: #ff6b6b; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            ‚úó Reject Request
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Approved Admins -->
                        ${approvedRequests.length > 0 ? `
                            <div style="background: #d4edda; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #10ac84;">
                                <h3 style="margin: 0 0 1rem 0; color: #155724;">‚úÖ Approved Admins (${approvedRequests.length})</h3>
                                ${approvedRequests.map(req => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h4 style="margin: 0 0 0.25rem 0; color: #333;">Admin</h4>
                                                <p style="margin: 0; color: #666; font-size: 0.85rem;">üì± ${req.mobile}</p>
                                                <p style="margin: 0.25rem 0 0 0; color: #999; font-size: 0.8rem;">Approved: ${new Date(req.approvedAt).toLocaleString()}</p>
                                            </div>
                                            <span style="background: #10ac84; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Active</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Rejected Requests -->
                        ${rejectedRequests.length > 0 ? `
                            <div style="background: #f8d7da; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ff6b6b;">
                                <h3 style="margin: 0 0 1rem 0; color: #721c24;">‚ùå Rejected Requests (${rejectedRequests.length})</h3>
                                ${rejectedRequests.map(req => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h4 style="margin: 0 0 0.25rem 0; color: #333;">Request</h4>
                                                <p style="margin: 0; color: #666; font-size: 0.85rem;">üì± ${req.mobile}</p>
                                            </div>
                                            <span style="background: #ff6b6b; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Rejected</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <button onclick="showAdminDashboard('${Object.keys(superAdmins)[0]}')" 
                                style="width: 100%; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            // Approve admin from dashboard
            function approveAdminFromDashboard(mobile) {
                if (confirm(`Approve admin access for ${mobile}?`)) {
                    approveAdmin(mobile);
                    alert(`‚úÖ Admin access approved for ${mobile}!\n\nThey can now login as admin.`);
                    showPendingAdminRequests(); // Refresh the list
                }
            }
            
            // Reject admin from dashboard
            function rejectAdminFromDashboard(mobile) {
                if (confirm(`Reject admin access request for ${mobile}?`)) {
                    rejectAdmin(mobile);
                    alert(`‚ùå Admin access request rejected for ${mobile}.`);
                    showPendingAdminRequests(); // Refresh the list
                }
            }
            
            // Driver Management Functions for Admin Dashboard
            
            function showDrivers() {
                // Get all pending drivers
                const pendingDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'pending')
                    .map(([mobile, driver]) => ({ mobile, ...driver }));
                
                const approvedDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'approved')
                    .map(([mobile, driver]) => ({ mobile, ...driver }))
                    .sort((a, b) => {
                        // Sort by status: online first, then occupied, then offline
                        const statusOrder = { 'online': 1, 'occupied': 2, 'offline': 3 };
                        const aStatus = statusOrder[a.driverStatus] || 3;
                        const bStatus = statusOrder[b.driverStatus] || 3;
                        return aStatus - bStatus;
                    });
                
                const rejectedDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'rejected')
                    .map(([mobile, driver]) => ({ mobile, ...driver }));
                
                const deactivatedDrivers = Object.entries(driverApprovalStatus)
                    .filter(([_, driver]) => driver.approvalStatus === 'deactivated')
                    .map(([mobile, driver]) => ({ mobile, ...driver }));
                
                document.getElementById('portalTitle').textContent = 'üöó Manage Drivers';
                document.getElementById('portalContent').innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto;">
                        <!-- Pending Drivers Section -->
                        <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ffc107;">
                            <h3 style="margin: 0 0 1rem 0; color: #856404;">‚è≥ Pending Approval (${pendingDrivers.length})</h3>
                            ${pendingDrivers.length === 0 ? `
                                <p style="color: #856404; margin: 0; font-size: 0.9rem;">No pending driver applications</p>
                            ` : pendingDrivers.map(driver => `
                                <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                        <div>
                                            <h4 style="margin: 0 0 0.5rem 0; color: #333;">${driver.name}</h4>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üì± ${driver.phone}</p>
                                            <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">üìß ${driver.email}</p>
                                        </div>
                                        <span style="background: #ffc107; color: #856404; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Pending</span>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>License:</strong> ${driver.licenseNumber}</p>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Aadhar:</strong> ${driver.aadharNumber}</p>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Vehicle:</strong> ${driver.vehicleType}</p>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Experience:</strong> ${driver.experience} years</p>
                                        <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;"><strong>Address:</strong> ${driver.address}</p>
                                        <p style="margin: 0.25rem 0; color: #999; font-size: 0.85rem;"><strong>Registered:</strong> ${new Date(driver.registeredAt).toLocaleString()}</p>
                                    </div>
                                    ${driver.documents ? `
                                        <div style="background: #e7f3ff; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem;">
                                            <p style="margin: 0 0 0.5rem 0; color: #0d47a1; font-weight: 600; font-size: 0.9rem;">üìÑ Documents:</p>
                                            <p style="margin: 0.25rem 0; color: #0d47a1; font-size: 0.85rem;">${driver.documents.license ? '‚úì License: ' + driver.documents.license : '‚úó License not uploaded'}</p>
                                            <p style="margin: 0.25rem 0; color: #0d47a1; font-size: 0.85rem;">${driver.documents.aadhar ? '‚úì Aadhar: ' + driver.documents.aadhar : '‚úó Aadhar not uploaded'}</p>
                                            <p style="margin: 0.25rem 0; color: #0d47a1; font-size: 0.85rem;">${driver.documents.photo ? '‚úì Photo: ' + driver.documents.photo : '‚úó Photo not uploaded'}</p>
                                        </div>
                                    ` : ''}
                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem;">
                                        <button onclick="approveDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                style="background: #10ac84; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            ‚úì Approve
                                        </button>
                                        <button onclick="rejectDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                style="background: #ff9800; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            ‚úó Reject
                                        </button>
                                        <button onclick="deleteDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                style="background: #dc3545; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            üóëÔ∏è Delete
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Approved Drivers Section -->
                        <div style="background: #d4edda; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #10ac84;">
                            <h3 style="margin: 0 0 1rem 0; color: #155724;">‚úÖ Approved Drivers (${approvedDrivers.length})</h3>
                            ${approvedDrivers.length === 0 ? `
                                <p style="color: #155724; margin: 0; font-size: 0.9rem;">No approved drivers yet</p>
                            ` : approvedDrivers.map(driver => `
                                <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.75rem;">
                                        <div style="flex: 1; min-width: 200px;">
                                            <h4 style="margin: 0 0 0.25rem 0; color: #333;">${driver.name}</h4>
                                            <p style="margin: 0; color: #666; font-size: 0.85rem;">üì± ${driver.phone} | üöó ${driver.vehicleType}</p>
                                            ${driver.lastStatusChange ? `<p style="margin: 0.25rem 0 0 0; color: #999; font-size: 0.75rem;">Last update: ${new Date(driver.lastStatusChange).toLocaleString()}</p>` : ''}
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                            ${driver.driverStatus === 'online' ? 
                                                '<span style="background: #10ac84; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">üü¢ Online</span>' :
                                              driver.driverStatus === 'occupied' ?
                                                '<span style="background: #ff6b6b; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">üî¥ Occupied</span>' :
                                                '<span style="background: #6c757d; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">‚ö´ Offline</span>'
                                            }
                                            <button onclick="deactivateDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                    style="background: #ff9800; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                                üö´ Deactivate
                                            </button>
                                            <button onclick="deleteDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                    style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                                üóëÔ∏è Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Deactivated Drivers Section -->
                        ${deactivatedDrivers.length > 0 ? `
                            <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ff9800;">
                                <h3 style="margin: 0 0 1rem 0; color: #856404;">üö´ Deactivated Drivers (${deactivatedDrivers.length})</h3>
                                ${deactivatedDrivers.map(driver => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 0.75rem;">
                                            <div style="flex: 1; min-width: 200px;">
                                                <h4 style="margin: 0 0 0.25rem 0; color: #333;">${driver.name}</h4>
                                                <p style="margin: 0.25rem 0; color: #666; font-size: 0.85rem;">üì± ${driver.phone} | üöó ${driver.vehicleType}</p>
                                                ${driver.deactivatedDate ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">üïê Deactivated: ${new Date(driver.deactivatedDate).toLocaleString()}</p>` : ''}
                                                ${driver.deactivatedByName ? `<p style="margin: 0.25rem 0; color: #999; font-size: 0.8rem;">üë§ By: ${driver.deactivatedByName}</p>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                                <span style="background: #ff9800; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Deactivated</span>
                                                <button onclick="reactivateDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                        style="background: #10ac84; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                                    ‚úì Reactivate
                                                </button>
                                                <button onclick="deleteDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                        style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                                    üóëÔ∏è Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Rejected Drivers Section -->
                        ${rejectedDrivers.length > 0 ? `
                            <div style="background: #f8d7da; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 4px solid #ff6b6b;">
                                <h3 style="margin: 0 0 1rem 0; color: #721c24;">‚ùå Rejected Drivers (${rejectedDrivers.length})</h3>
                                ${rejectedDrivers.map(driver => `
                                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="flex: 1;">
                                                <h4 style="margin: 0 0 0.25rem 0; color: #333;">${driver.name}</h4>
                                                <p style="margin: 0; color: #666; font-size: 0.85rem;">üì± ${driver.phone}</p>
                                                ${driver.rejectionReason ? `<p style="margin: 0.5rem 0 0 0; color: #721c24; font-size: 0.85rem;"><strong>Reason:</strong> ${driver.rejectionReason}</p>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                                <span style="background: #ff6b6b; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Rejected</span>
                                                <button onclick="deleteDriverFromDashboard('${driver.phone}', '${driver.name}')" 
                                                        style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                                                    üóëÔ∏è Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <button onclick="showAdminDashboard()" 
                                style="width: 100%; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>
                `;
            }
            
            // Approve driver from dashboard
            function approveDriverFromDashboard(mobile, name) {
                if (confirm(`Approve driver ${name} (${mobile})?`)) {
                    approveDriver(mobile);
                    alert(`‚úÖ Driver ${name} has been approved!\n\nThey can now login and access their dashboard.`);
                    showDrivers(); // Refresh the list
                }
            }
            
            // Reject driver from dashboard
            function rejectDriverFromDashboard(mobile, name) {
                const reason = prompt(`Reject driver ${name} (${mobile})?\n\nPlease enter rejection reason:`);
                if (reason !== null && reason.trim() !== '') {
                    rejectDriver(mobile, reason);
                    alert(`‚ùå Driver ${name} has been rejected.\n\nReason: ${reason}`);
                    showDrivers(); // Refresh the list
                } else if (reason !== null) {
                    alert('Please provide a rejection reason.');
                }
            }
            
            // Deactivate driver from dashboard
            function deactivateDriverFromDashboard(mobile, name) {
                if (confirm(`‚ö†Ô∏è Deactivate Driver?\n\nAre you sure you want to deactivate ${name} (${mobile})?\n\nThey will not be able to login or accept rides.`)) {
                    deactivateDriver(mobile);
                    alert(`üö´ Driver ${name} has been deactivated.\n\nThey can no longer access their account.`);
                    showDrivers(); // Refresh the list
                }
            }
            
            // Deactivate driver function
            function deactivateDriver(mobile) {
                if (driverApprovalStatus[mobile]) {
                    // Get current admin info
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    const adminName = currentAdmin.name || 'Admin';
                    
                    // Update driver status to deactivated
                    driverApprovalStatus[mobile].approvalStatus = 'deactivated';
                    driverApprovalStatus[mobile].deactivatedBy = currentAdmin.phone || 'admin';
                    driverApprovalStatus[mobile].deactivatedByName = adminName;
                    driverApprovalStatus[mobile].deactivatedDate = new Date().toISOString();
                    
                    saveDriverData(); // Save to localStorage
                    console.log('üö´ Driver deactivated:', mobile);
                    return true;
                }
                console.log('‚ùå Driver not found:', mobile);
                alert('‚ùå Driver not found in system');
                return false;
            }
            
            // Reactivate driver from dashboard
            function reactivateDriverFromDashboard(mobile, name) {
                if (confirm(`‚úÖ Reactivate Driver?\n\nAre you sure you want to reactivate ${name} (${mobile})?\n\nThey will be able to login and accept rides again.`)) {
                    reactivateDriver(mobile);
                    alert(`‚úÖ Driver ${name} has been reactivated.\n\nThey can now access their account.`);
                    showDrivers(); // Refresh the list
                }
            }
            
            // Delete driver from dashboard
            function deleteDriverFromDashboard(mobile, name) {
                if (confirm(`‚ö†Ô∏è DELETE DRIVER?\n\nAre you ABSOLUTELY SURE you want to permanently delete ${name} (${mobile})?\n\n‚ö†Ô∏è THIS ACTION CANNOT BE UNDONE!\n\nAll driver data will be permanently removed:\n- Profile information\n- Documents\n- History\n- Statistics\n\nType "DELETE" in the next prompt to confirm.`)) {
                    const confirmation = prompt(`To confirm deletion of ${name}, type "DELETE" (in capital letters):`);
                    if (confirmation === 'DELETE') {
                        deleteDriver(mobile);
                        notify('Driver Deleted üóëÔ∏è', `${name} has been permanently deleted from the system`, 'error');
                        alert(`üóëÔ∏è Driver ${name} has been permanently deleted.\n\nAll data has been removed from the system.`);
                        showDrivers(); // Refresh the list
                    } else if (confirmation !== null) {
                        alert('‚ùå Deletion cancelled. Confirmation text did not match.');
                    }
                }
            }
            
            // Reactivate driver function
            function reactivateDriver(mobile) {
                if (driverApprovalStatus[mobile]) {
                    // Get current admin info
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    const adminName = currentAdmin.name || 'Admin';
                    
                    // Store reactivation history (optional)
                    if (!driverApprovalStatus[mobile].reactivationHistory) {
                        driverApprovalStatus[mobile].reactivationHistory = [];
                    }
                    driverApprovalStatus[mobile].reactivationHistory.push({
                        reactivatedBy: currentAdmin.phone || 'admin',
                        reactivatedByName: adminName,
                        reactivatedDate: new Date().toISOString(),
                        previousDeactivationDate: driverApprovalStatus[mobile].deactivatedDate
                    });
                    
                    // Update driver status back to approved
                    driverApprovalStatus[mobile].approvalStatus = 'approved';
                    driverApprovalStatus[mobile].reactivatedDate = new Date().toISOString();
                    
                    // Keep deactivation history but mark as reactivated
                    driverApprovalStatus[mobile].wasDeactivated = true;
                    driverApprovalStatus[mobile].lastDeactivatedDate = driverApprovalStatus[mobile].deactivatedDate;
                    driverApprovalStatus[mobile].lastDeactivatedBy = driverApprovalStatus[mobile].deactivatedByName;
                    
                    saveDriverData(); // Save to localStorage
                    console.log('‚úÖ Driver reactivated:', mobile);
                    return true;
                }
                console.log('‚ùå Driver not found:', mobile);
                alert('‚ùå Driver not found in system');
                return false;
            }
            
            // Delete driver function (PERMANENT)
            function deleteDriver(mobile) {
                if (driverApprovalStatus[mobile]) {
                    // Get driver name for logging
                    const driverName = driverApprovalStatus[mobile].name;
                    
                    // Get current admin info for audit trail
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    const adminName = currentAdmin.name || 'Admin';
                    
                    // Log deletion for audit (optional - could be sent to backend)
                    console.log('üóëÔ∏è DRIVER DELETED:', {
                        mobile: mobile,
                        name: driverName,
                        deletedBy: adminName,
                        deletedAt: new Date().toISOString(),
                        driverData: driverApprovalStatus[mobile]
                    });
                    
                    // Permanently delete driver from system
                    delete driverApprovalStatus[mobile];
                    saveDriverData(); // Save to localStorage
                    
                    console.log('‚úÖ Driver permanently deleted:', mobile);
                    return true;
                }
                console.log('‚ùå Driver not found:', mobile);
                alert('‚ùå Driver not found in system');
                return false;
            }

            // Close modal when clicking outside
            document.getElementById('portalModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closePortal();
                }
            });
        </script>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
            <h3>üîî Notifications</h3>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="markAllAsRead()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.75rem; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                    Mark all read
                </button>
                <span onclick="toggleNotificationPanel()" style="cursor: pointer; font-size: 1.5rem;">&times;</span>
            </div>
        </div>
        <div class="notification-list" id="notificationList">
            <div class="notification-empty">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">üîï</div>
                <p>No notifications yet</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Notification System Script -->
    <script>
        // Notification System
        const NotificationSystem = {
            notifications: [],
            unreadCount: 0,
            soundEnabled: true,

            init() {
                // Request browser notification permission
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                // Load notifications from localStorage
                this.loadNotifications();
                this.updateBadge();
            },

            // Add notification
            add(title, message, type = 'info', data = {}) {
                const notification = {
                    id: Date.now(),
                    title,
                    message,
                    type,
                    timestamp: new Date().toISOString(),
                    read: false,
                    data
                };

                this.notifications.unshift(notification);
                this.unreadCount++;
                this.saveNotifications();
                this.updateBadge();
                this.updatePanel();

                // Show toast
                this.showToast(title, message, type);

                // Show browser notification
                this.showBrowserNotification(title, message);

                // Play sound
                if (this.soundEnabled) {
                    this.playNotificationSound();
                }

                return notification;
            },

            // Show toast notification
            showToast(title, message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                };

                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.info}</div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <div class="toast-close" onclick="this.parentElement.remove()">√ó</div>
                `;

                container.appendChild(toast);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
            },

            // Show browser notification
            showBrowserNotification(title, message) {
                if ('Notification' in window && Notification.permission === 'granted') {
                    const notification = new Notification(title, {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">üöó</text></svg>',
                        badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">üîî</text></svg>',
                        tag: 'topfirst-drivers',
                        requireInteraction: false
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                }
            },

            // Play notification sound
            playNotificationSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('Audio not supported');
                }
            },

            // Update notification badge
            updateBadge() {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    if (this.unreadCount > 0) {
                        badge.textContent = this.unreadCount > 99 ? '99+' : this.unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            },

            // Update notification panel
            updatePanel() {
                const list = document.getElementById('notificationList');
                if (!list) return;
                
                if (this.notifications.length === 0) {
                    list.innerHTML = `
                        <div class="notification-empty">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;">üîï</div>
                            <p>No notifications yet</p>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = this.notifications.map(notif => `
                    <div class="notification-item ${!notif.read ? 'unread' : ''}" onclick="NotificationSystem.markAsRead(${notif.id})">
                        <div class="notification-title">${this.getIcon(notif.type)} ${notif.title}</div>
                        <div class="notification-message">${notif.message}</div>
                        <div class="notification-time">${this.formatTime(notif.timestamp)}</div>
                    </div>
                `).join('');
            },

            // Get icon for notification type
            getIcon(type) {
                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è',
                    booking: 'üöó',
                    driver: 'üë®‚Äç‚úàÔ∏è',
                    customer: 'üë§',
                    admin: 'üë®‚Äçüíº'
                };
                return icons[type] || icons.info;
            },

            // Format timestamp
            formatTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;
                return date.toLocaleDateString();
            },

            // Mark notification as read
            markAsRead(id) {
                const notif = this.notifications.find(n => n.id === id);
                if (notif && !notif.read) {
                    notif.read = true;
                    this.unreadCount--;
                    this.saveNotifications();
                    this.updateBadge();
                    this.updatePanel();
                }
            },

            // Mark all as read
            markAllAsRead() {
                this.notifications.forEach(n => n.read = true);
                this.unreadCount = 0;
                this.saveNotifications();
                this.updateBadge();
                this.updatePanel();
                this.showToast('Success', 'All notifications marked as read', 'success');
            },

            // Save to localStorage
            saveNotifications() {
                localStorage.setItem('notifications', JSON.stringify(this.notifications));
                localStorage.setItem('unreadCount', this.unreadCount);
            },

            // Load from localStorage
            loadNotifications() {
                const saved = localStorage.getItem('notifications');
                if (saved) {
                    this.notifications = JSON.parse(saved);
                    this.unreadCount = parseInt(localStorage.getItem('unreadCount') || '0');
                }
            },

            // Clear all notifications
            clearAll() {
                this.notifications = [];
                this.unreadCount = 0;
                this.saveNotifications();
                this.updateBadge();
                this.updatePanel();
            }
        };

        // Toggle notification panel
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            if (panel) {
                panel.classList.toggle('show');
            }
        }

        // Mark all as read
        function markAllAsRead() {
            NotificationSystem.markAllAsRead();
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notificationPanel');
            const bell = document.querySelector('.notification-bell');
            
            if (panel && bell && panel.classList.contains('show') && 
                !panel.contains(event.target) && 
                !bell.contains(event.target)) {
                panel.classList.remove('show');
            }
        });

        // Initialize notification system on page load
        window.addEventListener('DOMContentLoaded', function() {
            NotificationSystem.init();
        });

        // Helper function to send notifications from anywhere in the code
        function notify(title, message, type = 'info') {
            return NotificationSystem.add(title, message, type);
        }

        // Integrate notifications with existing functions
        // Override the original handleDriverRegistration to add notification
        const originalHandleDriverRegistration = handleDriverRegistration;
        handleDriverRegistration = function(event) {
            const result = originalHandleDriverRegistration(event);
            // Notification is shown in the success message already
            return result;
        };
    </script>
</body>
</html>
